<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Intro and Overview References CLAIM: This article synthesizes conclusions and methods from multiple websites and is not pure original. 本文综合了多个网站的结论和方法，并非原创。 You may find these websites useful: Workflow for FPGA development Some open-source tools IceStudio for M2 Mac FPGA Toolchain VHDL compile chain on MacOS Tools related You need these: gtkwave: main RTL wave creator Icarus Verilog, and this manual YoSYS: .v to .json GHDL: compile, link and simulation tool for VHDL netlistsvg: .">
<title>RTL Analysis environment on MacOS (MacOS搭建RTL分析框架)</title>

<link rel='canonical' href='http://localhost:1313/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/'>

<link rel="stylesheet" href="/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css"><meta property='og:title' content="RTL Analysis environment on MacOS (MacOS搭建RTL分析框架)">
<meta property='og:description' content="Intro and Overview References CLAIM: This article synthesizes conclusions and methods from multiple websites and is not pure original. 本文综合了多个网站的结论和方法，并非原创。 You may find these websites useful: Workflow for FPGA development Some open-source tools IceStudio for M2 Mac FPGA Toolchain VHDL compile chain on MacOS Tools related You need these: gtkwave: main RTL wave creator Icarus Verilog, and this manual YoSYS: .v to .json GHDL: compile, link and simulation tool for VHDL netlistsvg: .">
<meta property='og:url' content='http://localhost:1313/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/'>
<meta property='og:site_name' content='Marcobisky'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Verilog' /><meta property='article:published_time' content='2024-08-31T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2024-08-31T00:00:00&#43;00:00'/><meta property='og:image' content='http://localhost:1313/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/cover.png' />
<meta name="twitter:title" content="RTL Analysis environment on MacOS (MacOS搭建RTL分析框架)">
<meta name="twitter:description" content="Intro and Overview References CLAIM: This article synthesizes conclusions and methods from multiple websites and is not pure original. 本文综合了多个网站的结论和方法，并非原创。 You may find these websites useful: Workflow for FPGA development Some open-source tools IceStudio for M2 Mac FPGA Toolchain VHDL compile chain on MacOS Tools related You need these: gtkwave: main RTL wave creator Icarus Verilog, and this manual YoSYS: .v to .json GHDL: compile, link and simulation tool for VHDL netlistsvg: ."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='http://localhost:1313/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/cover.png' />
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/profile_hu4958575492368904475.png" width="300"
                            height="296" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Marcobisky</a></h1>
            <h2 class="site-description">Look for a new angle</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/479299347?spm_id_from=333.337.0.0'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1725028876150" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2284" data-darkreader-inline-fill="" xmlns:xlink="http://www.w3.org/1999/xlink" width="256" height="256"><path d="M306.005333 117.632L444.330667 256h135.296l138.368-138.325333a42.666667 42.666667 0 0 1 60.373333 60.373333L700.330667 256H789.333333A149.333333 149.333333 0 0 1 938.666667 405.333333v341.333334a149.333333 149.333333 0 0 1-149.333334 149.333333h-554.666666A149.333333 149.333333 0 0 1 85.333333 746.666667v-341.333334A149.333333 149.333333 0 0 1 234.666667 256h88.96L245.632 177.962667a42.666667 42.666667 0 0 1 60.373333-60.373334zM789.333333 341.333333h-554.666666a64 64 0 0 0-63.701334 57.856L170.666667 405.333333v341.333334a64 64 0 0 0 57.856 63.701333L234.666667 810.666667h554.666666a64 64 0 0 0 63.701334-57.856L853.333333 746.666667v-341.333334A64 64 0 0 0 789.333333 341.333333zM341.333333 469.333333a42.666667 42.666667 0 0 1 42.666667 42.666667v85.333333a42.666667 42.666667 0 0 1-85.333333 0v-85.333333a42.666667 42.666667 0 0 1 42.666666-42.666667z m341.333334 0a42.666667 42.666667 0 0 1 42.666666 42.666667v85.333333a42.666667 42.666667 0 0 1-85.333333 0v-85.333333a42.666667 42.666667 0 0 1 42.666667-42.666667z" p-id="2285" fill="#c1c1c1" data-darkreader-inline-fill="" style="--darkreader-inline-fill: #3b4042;"></path></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/Marcobisky'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="http://localhost:1313/" selected>English</option>
                                
                                    <option value="http://localhost:1313/zh-cn/" >中文</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#intro-and-overview">Intro and Overview</a>
      <ol>
        <li><a href="#references">References</a></li>
        <li><a href="#tools-related">Tools related</a></li>
      </ol>
    </li>
    <li><a href="#first-project-in-verilog">First Project in Verilog</a>
      <ol>
        <li><a href="#install-icarus-verilog-compiler">Install Icarus Verilog Compiler</a></li>
        <li><a href="#compilation-and-simulation">Compilation and Simulation</a></li>
        <li><a href="#synthesis-and-visualization">Synthesis and Visualization</a></li>
        <li><a href="#makefile-work-flow">Makefile Work Flow</a></li>
      </ol>
    </li>
    <li><a href="#first-project-in-vhdl">First Project in VHDL</a>
      <ol>
        <li><a href="#install-ghdl-compiler">Install GHDL Compiler</a></li>
        <li><a href="#compilation-linking-and-simulation">Compilation, Linking and Simulation</a></li>
        <li><a href="#no-synthesis-and-visualization-plan">No Synthesis and Visualization Plan</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/">
                <img src="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/cover_hu13192264385292871569.png"
                        srcset="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/cover_hu13192264385292871569.png 800w, /p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/cover_hu2619526007067249935.png 1600w"
                        width="800" 
                        height="183" 
                        loading="lazy"
                        alt="Featured image of post RTL Analysis environment on MacOS (MacOS搭建RTL分析框架)" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/cs/" style="background-color: #2a9d8f; color: #fff;">
                CS
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/">RTL Analysis environment on MacOS (MacOS搭建RTL分析框架)</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Aug 31, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    9 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="intro-and-overview">Intro and Overview
</h2><h3 id="references">References
</h3><p><strong>CLAIM</strong>: This article synthesizes conclusions and methods from multiple websites and is not pure original. 本文综合了多个网站的结论和方法，并非原创。</p>
<p>You may find these websites useful:</p>
<ul>
<li><a class="link" href="https://nishtahir.com/a-mostly-free-fpga-development-workflow-for-macos/"  target="_blank" rel="noopener"
    >Workflow for FPGA development</a></li>
<li><a class="link" href="https://hackernoon.com/getting-started-using-open-source-fpga-tools"  target="_blank" rel="noopener"
    >Some open-source tools</a></li>
<li><a class="link" href="https://www.hackster.io/whitney-knitter/fpga-development-on-m2-mac-tinyfpga-with-icestudio-39c300"  target="_blank" rel="noopener"
    >IceStudio for M2 Mac</a></li>
<li><a class="link" href="https://github.com/YosysHQ/fpga-toolchain?tab=readme-ov-file"  target="_blank" rel="noopener"
    >FPGA Toolchain</a></li>
<li><a class="link" href="https://www.reddit.com/r/VHDL/comments/12707lp/ghdl_on_mac_m1/"  target="_blank" rel="noopener"
    >VHDL compile chain on MacOS</a></li>
</ul>
<h3 id="tools-related">Tools related
</h3><ul>
<li>
<p>You need these:</p>
<ul>
<li><a class="link" href="https://saiankit.medium.com/how-to-simulate-verilog-models-on-macos-5a6f821b2c4f"  target="_blank" rel="noopener"
    >gtkwave</a>: main RTL wave creator</li>
<li><a class="link" href="https://github.com/steveicarus/iverilog"  target="_blank" rel="noopener"
    >Icarus Verilog</a>, <a class="link" href="https://steveicarus.github.io/iverilog/usage/getting_started.html"  target="_blank" rel="noopener"
    >and this manual</a></li>
<li><a class="link" href="https://github.com/yosyshq/yosys"  target="_blank" rel="noopener"
    >YoSYS</a>: <code>.v</code> to <code>.json</code></li>
<li><a class="link" href="https://github.com/ghdl/ghdl?tab=readme-ov-file"  target="_blank" rel="noopener"
    >GHDL</a>: compile, link and simulation tool for VHDL</li>
<li><a class="link" href="https://github.com/nturley/netlistsvg?tab=readme-ov-file"  target="_blank" rel="noopener"
    >netlistsvg</a>: <code>.json</code> to <code>.svg</code></li>
</ul>
</li>
<li>
<p>Not nessasarily required:</p>
<ul>
<li><a class="link" href="https://sigrok.org/doc/pulseview/unstable/manual.html#_mac_os_x"  target="_blank" rel="noopener"
    >Pulseview</a>: Logic Analyzer (Not required though)</li>
<li><a class="link" href="https://github.com/hneemann/Digital/releases"  target="_blank" rel="noopener"
    >Digital</a>: Visual simulation</li>
</ul>
</li>
<li>
<p>Useful vscode plugins:</p>
<ul>
<li><a class="link" href="https://github.com/mshr-h/vscode-verilog-hdl-support"  target="_blank" rel="noopener"
    >Verilog Support</a>: vscode verilog language highlighter</li>
<li><a class="link" href="https://marketplace.visualstudio.com/items?itemName=wavetrace.wavetrace&amp;ref=nishtahir.com"  target="_blank" rel="noopener"
    >Wavetrace</a>: A nice vscode plugin to replace gtkwave</li>
</ul>
</li>
</ul>
<h2 id="first-project-in-verilog">First Project in Verilog
</h2><h3 id="install-icarus-verilog-compiler">Install Icarus Verilog Compiler
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">brew install icarus-verilog
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="compilation-and-simulation">Compilation and Simulation
</h3><!-- 新建文件夹`Verilog`，在其中新建两个测试文件：`GatedDLatch.v` and `GatedDLatch_tb.v`，前者为电路结构描述文件，后者为testbench文件，分别写入以下内容： -->
<p>Create new folder called <code>Verilog</code>, then create two test files named <code>GatedDLatch.v</code> and <code>GatedDLatch_tb.v</code>. The former is the description file of the circuit, the latter is for testbench. And write the following contents respectively:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">// in GatedDLatch.v
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">module</span> <span class="n">GatedDLatch</span> <span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">WE</span><span class="p">,</span> <span class="n">Out</span><span class="p">,</span> <span class="n">OutBar</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="n">Data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="n">WE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="n">Out</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="n">OutBar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// component name(output, input1, input2)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">wire</span> <span class="n">S</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">wire</span> <span class="n">R</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">wire</span> <span class="n">Dbar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">nand</span> <span class="n">g1</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">Data</span><span class="p">,</span> <span class="n">WE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">not</span> <span class="n">g2</span><span class="p">(</span><span class="n">Dbar</span><span class="p">,</span> <span class="n">Data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">nand</span> <span class="n">g3</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">WE</span><span class="p">,</span> <span class="n">Dbar</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">nand</span> <span class="n">g4</span><span class="p">(</span><span class="n">Out</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">OutBar</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">nand</span> <span class="n">g5</span><span class="p">(</span><span class="n">OutBar</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">Out</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>and</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">// in GatedDLatch_tb.v
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="no">`timescale</span> <span class="mh">1</span><span class="n">ns</span> <span class="o">/</span> <span class="mh">1</span><span class="n">ns</span> <span class="c1">// simulation time, time precision = 1ns
</span></span></span><span class="line"><span class="cl"><span class="c1">//Import the main code into the testbench
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="no">`include</span> <span class="s">&#34;GatedDLatch.v&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">module</span> <span class="n">GatedDLatch_tb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//Inputs as registers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">reg</span> <span class="n">Data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="n">WE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//Outputs as wires
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="n">Out</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">wire</span> <span class="n">OutBar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//Initialisation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">GatedDLatch</span> <span class="n">uut</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">WE</span><span class="p">,</span> <span class="n">Out</span><span class="p">,</span> <span class="n">OutBar</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//Name of the graph file that gets generated after we run
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">$dumpfile</span><span class="p">(</span><span class="s">&#34;GatedDLatch_tb.vcd&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">$dumpvars</span><span class="p">(</span><span class="mh">0</span><span class="p">,</span><span class="n">GatedDLatch_tb</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Data</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">WE</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">#</span><span class="mh">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Data</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">#</span><span class="mh">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">WE</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">#</span><span class="mh">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">WE</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">#</span><span class="mh">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Data</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">#</span><span class="mh">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">WE</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">#</span><span class="mh">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">WE</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">#</span><span class="mh">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">$display</span><span class="p">(</span><span class="s">&#34;Test complete&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 终端运行： -->
<p>Run this in the terminal:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">iverilog -o GatedDLatch_tb.vvp GatedDLatch_tb.v
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 将产生的二进制临时文件 `GatedDLatch_tb.vvp` 用 `vvp` 命令转换为 `GatedDLatch_tb.vcd`  waveform file: -->
<p>Use <code>vvp</code> command to convert the binary temperary file <code>GatedDLatch_tb.vvp</code> to <code>GatedDLatch_tb.vcd</code>  waveform file:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">vvp GatedDLatch_tb.vvp
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 安装 [Wavetrace](https://marketplace.visualstudio.com/items?itemName=wavetrace.wavetrace&ref=nishtahir.com) 插件后即可查看波形： -->
<p>Install <a class="link" href="https://marketplace.visualstudio.com/items?itemName=wavetrace.wavetrace&amp;ref=nishtahir.com"  target="_blank" rel="noopener"
    >Wavetrace</a> in vscode to view the waveform:</p>
<p><img src="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/wave-in-vscode.png"
	width="2084"
	height="1104"
	srcset="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/wave-in-vscode_hu3041852836802553168.png 480w, /p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/wave-in-vscode_hu15395453839799257878.png 1024w"
	loading="lazy"
	
		alt="Display the waveform in vscode"
	
	
		class="gallery-image" 
		data-flex-grow="188"
		data-flex-basis="453px"
	
></p>
<!-- 也可以用 [gtkwave](https://saiankit.medium.com/how-to-simulate-verilog-models-on-macos-5a6f821b2c4f) 软件内查看波形： -->
<p>You can also install <a class="link" href="https://saiankit.medium.com/how-to-simulate-verilog-models-on-macos-5a6f821b2c4f"  target="_blank" rel="noopener"
    >gtkwave</a> to view the waveform.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">brew install gtkwave
</span></span><span class="line"><span class="cl">gtkwave GatedDLatch_tb.vcd
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/gtkwave1.png"
	width="2570"
	height="1256"
	srcset="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/gtkwave1_hu2469622110725725353.png 480w, /p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/gtkwave1_hu219284880838504624.png 1024w"
	loading="lazy"
	
		alt="Before imported"
	
	
		class="gallery-image" 
		data-flex-grow="204"
		data-flex-basis="491px"
	
></p>
<!-- 下拉 GatedDLatch_tb 列表可显示波形： -->
<p>Expand GatedDLatch_tb list to display the waveform:</p>
<p><img src="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/gtkwave2.png"
	width="2570"
	height="1256"
	srcset="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/gtkwave2_hu4429147937700778356.png 480w, /p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/gtkwave2_hu15228744967348331696.png 1024w"
	loading="lazy"
	
		alt="Displaying waveform"
	
	
		class="gallery-image" 
		data-flex-grow="204"
		data-flex-basis="491px"
	
></p>
<h3 id="synthesis-and-visualization">Synthesis and Visualization
</h3><!-- 我们需要将画出来的电路拓扑可视化（产生Schematics），首先用 `YoSYS` 将 Verilog 代码转化为数字逻辑电路的门级网表 (gate-level netlist)，先安装 `YoSYS`: -->
<p>We can also visualize the circuit topology (called generating schematics). First, use <code>YoSYS</code> to convert the verilog code into gate-level netlist. Of course you should install the command line tool <code>YoSYS</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">brew install yosys
</span></span><span class="line"><span class="cl">yosys -V # Verify Yosys installation
</span></span></code></pre></td></tr></table>
</div>
</div><!-- `YoSYS` 可将电路结构文件 `GatedDLatch.v` 转换为一个 `json` 文件： -->
<p><code>YoSYS</code> will first convert the circuit structure description file <code>GatedDLatch.v</code> into a <code>json</code> file:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yosys -p &#34;prep -top GatedDLatch; write_json GatedDLatch.json&#34; GatedDLatch.v
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 然后我们再安装 `netlistsvg` 工具: -->
<p>Then we install another tool called <code>netlistsvg</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># Install Node.js (if not already installed)
</span></span><span class="line"><span class="cl">brew install node
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Install netlistsvg globally using npm
</span></span><span class="line"><span class="cl">npm install -g netlistsvg
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Verify netlistsvg installation
</span></span><span class="line"><span class="cl">netlistsvg --version
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 用 `netlistsvg` 工具将 `GatedDLatch.json` 转换为 `GatedDLatch.svg`: -->
<p>Using the <code>netlistsvg</code> tool to convert <code>GatedDLatch.json</code> to <code>GatedDLatch.svg</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">netlistsvg GatedDLatch.json -o GatedDLatch.svg
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 预览 `GatedDLatch.svg` 可得电路结构图： -->
<p>Previewing GatedDLatch.svg will give you the circuit schematic:</p>
<p><img src="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/GatedDLatch.png"
	width="1784"
	height="718"
	srcset="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/GatedDLatch_hu766095519202326218.png 480w, /p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/GatedDLatch_hu10112389290357412345.png 1024w"
	loading="lazy"
	
		alt="GatedDLatch.svg"
	
	
		class="gallery-image" 
		data-flex-grow="248"
		data-flex-basis="596px"
	
></p>
<h3 id="makefile-work-flow">Makefile Work Flow
</h3><!-- 可见整个流程分为上述独立的两大块： -->
<p>The entire workflow can be divided into two major independent parts:</p>
<!-- * 编译、仿真
    * `iverilog` (Compilation)
    * `vvp` (Simulation)
* 合成、电路结构可视化
    * `yosys` (Synthesis)
    * `netlistsvg` (Visualization) -->
<ul>
<li>Compilation and Simulation:
<ul>
<li><code>iverilog</code> (Compilation)</li>
<li><code>vvp</code> (Simulation)</li>
</ul>
</li>
<li>Synthesis and Circuit Structure Visualization:
<ul>
<li><code>yosys</code> (Synthesis)</li>
<li><code>netlistsvg</code> (Visualization)</li>
</ul>
</li>
</ul>
<!-- 我们用 Makefile 自动化这个过程（确保你装了Make有关组件）：在之前建的 `Verilog` 文件夹下创建一个 `Makefile` 文件，加入以下内容： -->
<p>We use a Makefile to automate this process (ensure that Make and related components are installed): Create a <code>Makefile</code> file in the previously created <code>Verilog</code> folder and add the following content:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="c"># Description: Makefile for GatedDLatch
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nv">CIRCUIT_STRUCT</span> <span class="o">=</span> GatedDLatch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Directories
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nv">BUILD_DIR</span> <span class="o">=</span> build
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Ensure the build directory exists
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">$(BUILD_DIR)</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	mkdir -p <span class="k">$(</span>BUILD_DIR<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Compilation: iverilog compilation
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">iverilog</span><span class="o">:</span> <span class="k">$(</span><span class="nv">CIRCUIT_STRUCT</span><span class="k">)</span>.<span class="n">v</span> <span class="k">$(</span><span class="nv">CIRCUIT_STRUCT</span><span class="k">)</span><span class="n">_tb</span>.<span class="n">v</span> <span class="p">|</span> <span class="k">$(</span><span class="nv">BUILD_DIR</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	iverilog -o <span class="k">$(</span>BUILD_DIR<span class="k">)</span>/<span class="k">$(</span>CIRCUIT_STRUCT<span class="k">)</span>_tb.vvp <span class="k">$(</span>CIRCUIT_STRUCT<span class="k">)</span>_tb.v
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Simulation: generate waveform (.vcd)
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">vvp</span><span class="o">:</span> <span class="k">$(</span><span class="nv">BUILD_DIR</span><span class="k">)</span>/<span class="k">$(</span><span class="nv">CIRCUIT_STRUCT</span><span class="k">)</span><span class="n">_tb</span>.<span class="n">vvp</span>
</span></span><span class="line"><span class="cl">	vvp <span class="k">$(</span>BUILD_DIR<span class="k">)</span>/<span class="k">$(</span>CIRCUIT_STRUCT<span class="k">)</span>_tb.vvp
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Synthesis: generate circuit structure configuration file (.json)
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">YOSYS</span><span class="o">:</span> <span class="k">$(</span><span class="nv">CIRCUIT_STRUCT</span><span class="k">)</span>.<span class="n">v</span> <span class="p">|</span> <span class="k">$(</span><span class="nv">BUILD_DIR</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	yosys -p <span class="s2">&#34;prep -top </span><span class="k">$(</span>CIRCUIT_STRUCT<span class="k">)</span><span class="s2">; write_json </span><span class="k">$(</span>BUILD_DIR<span class="k">)</span><span class="s2">/</span><span class="k">$(</span>CIRCUIT_STRUCT<span class="k">)</span><span class="s2">.json&#34;</span> <span class="k">$(</span>CIRCUIT_STRUCT<span class="k">)</span>.v
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Visualization: generate human readable (.svg) from .json
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">NETLISTSVG</span><span class="o">:</span> <span class="k">$(</span><span class="nv">BUILD_DIR</span><span class="k">)</span>/<span class="k">$(</span><span class="nv">CIRCUIT_STRUCT</span><span class="k">)</span>.<span class="n">json</span> <span class="p">|</span> <span class="k">$(</span><span class="nv">BUILD_DIR</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	netlistsvg <span class="k">$(</span>BUILD_DIR<span class="k">)</span>/<span class="k">$(</span>CIRCUIT_STRUCT<span class="k">)</span>.json -o <span class="k">$(</span>BUILD_DIR<span class="k">)</span>/<span class="k">$(</span>CIRCUIT_STRUCT<span class="k">)</span>.svg
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Schematic diagram only: Synthesis then Visualization
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">schematic</span><span class="o">:</span> <span class="n">YOSYS</span> <span class="n">NETLISTSVG</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Run all steps
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">run_all</span><span class="o">:</span> <span class="n">iverilog</span> <span class="n">vvp</span> <span class="n">schematic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Clean build directory
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">clean</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	rm -rf <span class="k">$(</span>BUILD_DIR<span class="k">)</span>
</span></span><span class="line"><span class="cl">	rm -f <span class="k">$(</span>CIRCUIT_STRUCT<span class="k">)</span>_tb.vcd
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 每次改变文件后只需执行： -->
<p>After modifying the files, simply execute:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">make clean
</span></span><span class="line"><span class="cl">make run_all
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 即可生成所有相关文件： -->
<p>This will generate all the relevant files:</p>
<p><img src="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/inside-verilog.png"
	width="1480"
	height="422"
	srcset="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/inside-verilog_hu1930789048349129319.png 480w, /p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/inside-verilog_hu3391376725654501887.png 1024w"
	loading="lazy"
	
		alt="Project File Structure"
	
	
		class="gallery-image" 
		data-flex-grow="350"
		data-flex-basis="841px"
	
></p>
<h2 id="first-project-in-vhdl">First Project in VHDL
</h2><h3 id="install-ghdl-compiler">Install GHDL Compiler
</h3><!-- 和 Verilog 一样，VHDL 也是一种硬件描述语言。编译它需要另一个工具：[GHDL](https://github.com/ghdl/ghdl?tab=readme-ov-file). 在MacOS上安装它有几个坑，以下步骤在M2 Mac上实测有效（截止2024-09-01）： -->
<p>Similar to Verilog, VHDL is also a hardware description language. Compiling it requires another tool: <a class="link" href="https://github.com/ghdl/ghdl?tab=readme-ov-file"  target="_blank" rel="noopener"
    >GHDL</a>. Installing it on macOS can be tricky. The following steps have been tested on an M2 Mac (as of 2024-09-01):</p>
<!-- 用 `brew` 安装`vhdl`: -->
<p>Install <code>vhdl</code> using <code>brew</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">brew install vhdl
</span></span></code></pre></td></tr></table>
</div>
</div><!-- `vhdl` 有两个版本：LLVM和mcode，LLVM版本在Mac上有点问题，而brew下载的正是这个版本，所以我们从[这里](https://github.com/ghdl/ghdl/releases/tag/nightly)手动下载mcode的组件，我下的是 `ghdl-macos-11-mcode.tgz`。 -->
<p><code>vhdl</code> has two versions: LLVM and mcode. The LLVM version has some issues on macOS, and the brew-installed version uses LLVM, so we manually download the mcode version from <a class="link" href="https://github.com/ghdl/ghdl/releases/tag/nightly"  target="_blank" rel="noopener"
    >here</a>. I downloaded ghdl-macos-11-mcode.tgz.</p>
<p>Extract it by double-clicking, and you will get three files:</p>
<p><img src="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/ghdl-package.png"
	width="508"
	height="178"
	srcset="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/ghdl-package_hu3744545185272346616.png 480w, /p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/ghdl-package_hu13637183256512821827.png 1024w"
	loading="lazy"
	
		alt="GHDL-mcode package"
	
	
		class="gallery-image" 
		data-flex-grow="285"
		data-flex-basis="684px"
	
></p>
<!-- 将这三个文件复制粘贴到这个路径：`/opt/homebrew/Caskroom/ghdl/4.1.0`: -->
<p>Copy and paste these three files to the following path: <code>/opt/homebrew/Caskroom/ghdl/4.1.0</code>:</p>
<p><img src="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/copy-and-paste.png"
	width="2660"
	height="858"
	srcset="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/copy-and-paste_hu11701807239134399587.png 480w, /p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/copy-and-paste_hu7039729958784412111.png 1024w"
	loading="lazy"
	
		alt="Copy and Paste"
	
	
		class="gallery-image" 
		data-flex-grow="310"
		data-flex-basis="744px"
	
></p>
<p>In the terminal, type:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ghdl --version
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 如果有安全性提示，到系统设置 Privacy & Security 中允许即可: -->
<p>If you encounter security prompts, go to System Settings &gt; Privacy &amp; Security to allow access:</p>
<p><img src="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/settings.png"
	width="1414"
	height="506"
	srcset="/p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/settings_hu816027797844342137.png 480w, /p/rtl-analysis-environment-on-macos-macos%E6%90%AD%E5%BB%BArtl%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/settings_hu14419828442481486902.png 1024w"
	loading="lazy"
	
		alt="Allow Access in Privacy & Security"
	
	
		class="gallery-image" 
		data-flex-grow="279"
		data-flex-basis="670px"
	
></p>
<h3 id="compilation-linking-and-simulation">Compilation, Linking and Simulation
</h3><!-- 与Verilog不同，VHDL多了一步Linking，就是将component声明和其实体文件 (testbench) 链接在一起。Verilog为什么不要这一步？因为testbench文件中包含了声明的内容 (`include "GatedDLatch.v" `)，可自动链接。 -->
<p>Unlike Verilog, VHDL requires an additional Linking step, which connects the component declarations with their implementation files (testbench). Why doesn’t Verilog require this? Because the testbench file in Verilog includes the declaration contents (<code>include &quot;GatedDLatch.v&quot;</code>), so it links automatically.</p>
<!-- Verilog 中我们用了两中不同的工具 (`iverilog`, `vvp`) 来完成编译和仿真。而VHDL只用一个工具：`GHDL`. -->
<p>In Verilog, we used two separate tools (<code>iverilog</code> and <code>vvp</code>) for compilation and simulation. However, for VHDL, we only need one tool: <code>GHDL</code>.</p>
<!-- 新建文件夹`VHDLDemo`，在其中新建两个测试文件：`demo.vhdl` and `demo_tb.vhdl`，前者为电路结构描述文件，后者为testbench文件 (也可用`.vhd`为后缀)，分别写入以下内容： -->
<p>Create a new folder <code>VHDLDemo</code>, and within it, create two files: <code>demo.vhdl</code> and <code>demo_tb.vhdl</code>. The former describes the circuit structure, and the latter serves as the testbench file (you can also use <code>.vhd</code> as the suffix). Add the following content to the respective files:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vhdl" data-lang="vhdl"><span class="line"><span class="cl"><span class="k">library</span> <span class="nn">IEEE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">IEEE.STD_LOGIC_1164.</span><span class="k">ALL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">entity</span> <span class="nc">demo</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl">    <span class="k">port</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">:</span> <span class="k">in</span>  <span class="kt">STD_LOGIC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">B</span> <span class="o">:</span> <span class="k">in</span>  <span class="kt">STD_LOGIC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">O</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">STD_LOGIC</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span> <span class="nc">demo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">architecture</span> <span class="nc">Behavioral</span> <span class="k">of</span> <span class="nc">demo</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl"><span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">O</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="p">(</span><span class="n">A</span> <span class="k">and</span> <span class="n">B</span><span class="p">);</span> <span class="c1">-- NAND gate</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span> <span class="nc">Behavioral</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>and</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vhdl" data-lang="vhdl"><span class="line"><span class="cl"><span class="k">library</span> <span class="nn">IEEE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">IEEE.STD_LOGIC_1164.</span><span class="k">ALL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">entity</span> <span class="nc">demo_tb</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span> <span class="nc">demo_tb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">architecture</span> <span class="nc">Behavioral</span> <span class="k">of</span> <span class="nc">demo_tb</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl">    <span class="k">signal</span> <span class="n">A</span> <span class="o">:</span> <span class="kt">STD_LOGIC</span> <span class="o">:=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">signal</span> <span class="n">B</span> <span class="o">:</span> <span class="kt">STD_LOGIC</span> <span class="o">:=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">signal</span> <span class="n">O</span> <span class="o">:</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">-- Instantiate the unit under test (UUT)</span>
</span></span><span class="line"><span class="cl">    <span class="k">component</span> <span class="nc">demo</span>
</span></span><span class="line"><span class="cl">        <span class="k">port</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">A</span> <span class="o">:</span> <span class="k">in</span>  <span class="kt">STD_LOGIC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">B</span> <span class="o">:</span> <span class="k">in</span>  <span class="kt">STD_LOGIC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">O</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">STD_LOGIC</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span> <span class="k">component</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">UUT</span><span class="o">:</span> <span class="n">demo</span> <span class="k">port</span> <span class="k">map</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">B</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">O</span> <span class="o">=&gt;</span> <span class="n">O</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">-- Test process</span>
</span></span><span class="line"><span class="cl">    <span class="k">process</span>
</span></span><span class="line"><span class="cl">    <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="c1">-- Test case 1: A = 0, B = 0</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">B</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">wait</span> <span class="k">for</span> <span class="mi">10</span> <span class="n">ns</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">-- Test case 2: A = 0, B = 1</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">B</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">wait</span> <span class="k">for</span> <span class="mi">10</span> <span class="n">ns</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">-- Test case 3: A = 1, B = 0</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">B</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">wait</span> <span class="k">for</span> <span class="mi">10</span> <span class="n">ns</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">-- Test case 4: A = 1, B = 1</span>
</span></span><span class="line"><span class="cl">        <span class="n">A</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">B</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">wait</span> <span class="k">for</span> <span class="mi">10</span> <span class="n">ns</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">-- End of simulation</span>
</span></span><span class="line"><span class="cl">        <span class="k">wait</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span> <span class="k">process</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span> <span class="nc">Behavioral</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 再建立一个 `Makefile` 文件实现自动化： -->
<p>Create a <code>Makefile</code> to automate the process:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="c"># Description: Makefile for VHDLDemo
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nv">CIRCUIT</span> <span class="o">=</span> demo
</span></span><span class="line"><span class="cl"><span class="nv">TB</span> <span class="o">=</span> demo_tb
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_DIR</span> <span class="o">=</span> build
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Ensure the build directory exists
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">$(BUILD_DIR)</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	mkdir -p <span class="k">$(</span>BUILD_DIR<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Compilation: compile the design and testbench
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">ghdl_compile</span><span class="o">:</span> <span class="k">$(</span><span class="nv">BUILD_DIR</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	ghdl -a --workdir<span class="o">=</span><span class="k">$(</span>BUILD_DIR<span class="k">)</span> <span class="k">$(</span>CIRCUIT<span class="k">)</span>.vhdl
</span></span><span class="line"><span class="cl">	ghdl -a --workdir<span class="o">=</span><span class="k">$(</span>BUILD_DIR<span class="k">)</span> <span class="k">$(</span>TB<span class="k">)</span>.vhdl
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Linking: Elaborate the design and testbench
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">ghdl_elab</span><span class="o">:</span> <span class="n">ghdl_compile</span>
</span></span><span class="line"><span class="cl">	ghdl -e --workdir<span class="o">=</span><span class="k">$(</span>BUILD_DIR<span class="k">)</span> <span class="k">$(</span>TB<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Simulation: simulate the testbench
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">ghdl_simulate</span><span class="o">:</span> <span class="n">ghdl_elab</span>
</span></span><span class="line"><span class="cl">	ghdl -r --workdir<span class="o">=</span><span class="k">$(</span>BUILD_DIR<span class="k">)</span> <span class="k">$(</span>TB<span class="k">)</span> --vcd<span class="o">=</span><span class="k">$(</span>BUILD_DIR<span class="k">)</span>/<span class="k">$(</span>TB<span class="k">)</span>.vcd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">### These cannot work for now##############################################
</span></span></span><span class="line"><span class="cl"><span class="c"># # Synthesis: generate circuit structure configuration file (.json), you should have ghdl plugin installed for yosys, but I have error: &#34;ERROR: No such command: ghdl&#34; or &#34;dyld[5264]: missing symbol called&#34;, possible solution could be to install yosys from source, but not sure
</span></span></span><span class="line"><span class="cl"><span class="c"># YOSYS: $(CIRCUIT).vhdl | $(BUILD_DIR)
</span></span></span><span class="line"><span class="cl"><span class="c"># 	yosys -p &#34;ghdl $(CIRCUIT); prep -top $(CIRCUIT); write_json -compat-int $(BUILD_DIR)/$(CIRCUIT).json&#34; $(CIRCUIT).vhdl
</span></span></span><span class="line"><span class="cl"><span class="c"></span>
</span></span><span class="line"><span class="cl"><span class="c"># # Visualization: generate human readable (.svg) from .json
</span></span></span><span class="line"><span class="cl"><span class="c"># NETLISTSVG: $(BUILD_DIR)/$(CIRCUIT).json  | $(BUILD_DIR)
</span></span></span><span class="line"><span class="cl"><span class="c"># 	netlistsvg $(BUILD_DIR)/$(CIRCUIT).json -o $(BUILD_DIR)/$(CIRCUIT).svg
</span></span></span><span class="line"><span class="cl"><span class="c"></span>
</span></span><span class="line"><span class="cl"><span class="c"># # Schematic diagram only: Synthesis then Visualization
</span></span></span><span class="line"><span class="cl"><span class="c"># schematic: YOSYS NETLISTSVG
</span></span></span><span class="line"><span class="cl"><span class="c"></span>
</span></span><span class="line"><span class="cl"><span class="c"># # Run all steps
</span></span></span><span class="line"><span class="cl"><span class="c"># run_all: ghdl_compile ghdl_elab ghdl_simulate YOSYS NETLISTSVG
</span></span></span><span class="line"><span class="cl"><span class="c">### These cannot work for now##############################################
</span></span></span><span class="line"><span class="cl"><span class="c"></span>
</span></span><span class="line"><span class="cl"><span class="c"># Run compilation, linking and simulation
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">run_cls</span><span class="o">:</span> <span class="n">ghdl_compile</span> <span class="n">ghdl_elab</span> <span class="n">ghdl_simulate</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Clean build directory
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">clean</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	rm -rf <span class="k">$(</span>BUILD_DIR<span class="k">)</span>
</span></span><span class="line"><span class="cl">	rm -f <span class="k">$(</span>TB<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Experiment: Run testbench without the design file
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nf">run_tb_only</span><span class="o">:</span> <span class="k">$(</span><span class="nv">BUILD_DIR</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	ghdl -a --workdir<span class="o">=</span><span class="k">$(</span>BUILD_DIR<span class="k">)</span> <span class="k">$(</span>TB<span class="k">)</span>.vhdl
</span></span><span class="line"><span class="cl">	ghdl -r --workdir<span class="o">=</span><span class="k">$(</span>BUILD_DIR<span class="k">)</span> <span class="k">$(</span>TB<span class="k">)</span> --vcd<span class="o">=</span><span class="k">$(</span>BUILD_DIR<span class="k">)</span>/<span class="k">$(</span>TB<span class="k">)</span>_no_design.vcd
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 运行过程自行理解。命令行执行： -->
<p>The running process is very clear. In the command line, execute:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">make clean
</span></span><span class="line"><span class="cl">make run_cls
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 即可。 -->
<p>This will complete the process.</p>
<!-- 如果你要看如果不编译链接 design file (`demo.vhdl`) 会出来什么，可以运行： -->
<p>If you want to see what happens if you skip compiling and linking the design file (<code>demo.vhdl</code>), run:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">make clean # Cannot omitted!
</span></span><span class="line"><span class="cl">make run_tb_only
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 你可以在vscode中或用gtkwave对比两次生成的 `.vcd` 文件，它们是有区别的。 -->
<p>You can compare the two <code>.vcd</code> files generated in VSCode or using GTKWave; they are different as expected.</p>
<h3 id="no-synthesis-and-visualization-plan">No Synthesis and Visualization Plan
</h3><!-- 注意这个 `Makefile` 没有包括画schematic diagram, 因为 `yosys` 需要装 `ghdl` 插件，目前适配不是很好，具体可参考 [ghdl-yosys-plugin](https://github.com/ghdl/ghdl-yosys-plugin?tab=readme-ov-file), [building-ghdl](https://ghdl.github.io/ghdl/development/building/index.html), 前者提到的方法在M2 Mac上已经试过，会报错： -->
<p>Note that this <code>Makefile</code> does not include steps to generate a schematic diagram because <code>yosys</code> requires a <code>ghdl</code> plugin. Currently, the integration is not very stable. You can refer to <a class="link" href="https://github.com/ghdl/ghdl-yosys-plugin?tab=readme-ov-file"  target="_blank" rel="noopener"
    >ghdl-yosys-plugin</a> and <a class="link" href="https://ghdl.github.io/ghdl/development/building/index.html"  target="_blank" rel="noopener"
    >building-ghdl</a> for more details. However, the suggested methods have been tested on M2 Mac and result in errors:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"> /----------------------------------------------------------------------------<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> <span class="p">|</span>  yosys -- Yosys Open SYnthesis Suite                                       <span class="p">|</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span>  Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2012</span> - <span class="m">2024</span>  Claire Xenia Wolf &lt;claire@yosyshq.com&gt;         <span class="p">|</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span>  Distributed under an ISC-like license, <span class="nb">type</span> <span class="s2">&#34;license&#34;</span> to see terms        <span class="p">|</span>
</span></span><span class="line"><span class="cl"> <span class="se">\-</span>---------------------------------------------------------------------------/
</span></span><span class="line"><span class="cl"> Yosys 0.44 <span class="o">(</span>git sha1 80ba43d26, clang++ 15.0.0 -fPIC -O3<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-- Running <span class="nb">command</span> <span class="sb">`</span>ghdl demo_tb.vhdl -e demo_tb<span class="p">;</span> prep -top demo_tb<span class="p">;</span> write_json demo.json<span class="err">&#39;</span> --
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1. Executing GHDL.
</span></span><span class="line"><span class="cl">dyld<span class="o">[</span>5264<span class="o">]</span>: missing symbol called
</span></span><span class="line"><span class="cl">zsh: abort      yosys -m ghdl -p
</span></span></code></pre></td></tr></table>
</div>
</div><!-- 这个问题在 [ghdl-yosys-plugin](https://github.com/ghdl/ghdl-yosys-plugin?tab=readme-ov-file) 的 Issues 里面也有人问了，没答案。 -->
<p>This issue has also been mentioned in the Issues section of <a class="link" href="https://github.com/ghdl/ghdl-yosys-plugin?tab=readme-ov-file"  target="_blank" rel="noopener"
    >ghdl-yosys-plugin</a>, but there is no solution yet.</p>
<!-- 可能的解决方法是从[源文件](https://github.com/YosysHQ/yosys)自行编译安装`yosys`，或者 `yosys` 或 `ghdl` 的版本不对，或缺少了[工具链](https://github.com/YosysHQ/fpga-toolchain)中的某个工具。或者用某个工具将 `VHDL` 转成 `Verilog` 后再合成 Schematics. -->
<p>Possible solutions might include compiling and installing yosys from <a class="link" href="https://github.com/YosysHQ/yosys"  target="_blank" rel="noopener"
    >source</a>, ensuring the correct versions of <code>yosys</code> and <code>ghdl</code>, or checking if any component of the FPGA <a class="link" href="https://github.com/YosysHQ/fpga-toolchain"  target="_blank" rel="noopener"
    >Toolchain</a> is missing. Alternatively, you could try converting <code>VHDL</code> to <code>Verilog</code> using some tool (like GPT) and then synthesizing the schematics.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/verilog/">Verilog</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/%E4%B8%80%E8%B5%B7%E9%80%A0%E8%BD%AE%E5%AD%90/">
        
        

        <div class="article-details">
            <h2 class="article-title">一起造轮子!</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/python-for-ml-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
        
        

        <div class="article-details">
            <h2 class="article-title">Python for ML 学习笔记</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E5%9C%A8-ios-%E4%B8%8B%E8%BD%BD%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%94%E7%94%A8/">
        
        

        <div class="article-details">
            <h2 class="article-title">在 ios 下载第三方应用</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/java%E9%A1%B9%E7%9B%AE%E5%AF%BC%E5%85%A5launchpad%E6%96%B9%E6%A1%88-macos/">
        
        

        <div class="article-details">
            <h2 class="article-title">java项目导入Launchpad方案 MacOS</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/create-your-own-website-using-hugo-on-macos/">
        
        

        <div class="article-details">
            <h2 class="article-title">Create your own website using Hugo on MacOS</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 Marcobisky
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.26.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
