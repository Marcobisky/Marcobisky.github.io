<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Random Notes on Coding – TinyML</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../cc-fpga/cc-fpga.html" rel="next">
<link href="../cc-os/cc-os.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6353c5142b84b22f6683470407aecb9b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-5549b3ede58740172b4e45471f64731a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-6353c5142b84b22f6683470407aecb9b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating slimcontent quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../c-riscv-asm/c-riscv-asm.html">Crash Courses</a></li><li class="breadcrumb-item"><a href="../cc-coding/cc-coding.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Random Notes on Coding</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">TinyML</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Prologue</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction 引入</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Resources 学习资料汇总</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../glossary/glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Glossary 名词解释</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../research-proposal/research-proposal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Research Proposal: New Inference Paradigms for ML at the Edge</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Environment Setup</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../env-setup/env-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">FPGA 开发环境配置</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">EDA</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../eda-notes/eda-notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">EDA Notes 笔记</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Crash Courses</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../c-riscv-asm/c-riscv-asm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">C 和 RISCV 汇编</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../riscv/riscv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">RISCV ISA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cc-os/cc-os.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">OS 操作系统原理</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cc-coding/cc-coding.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Random Notes on Coding</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cc-fpga/cc-fpga.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">FPGA 原理速成</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cc-cpu/cc-cpu.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">CPU 原理速成</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cc-gpu/cc-gpu.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">GPU 原理速成</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Neural Network</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nn-essence/nn-essence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">The Essence of NN 神经网络的本质</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../yolo/yolo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">YOLO Object Detection 目标检测</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">ML Accelerators</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hls-design/HLS-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">HLS Design FPGA 并行编程</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">CFU Playground</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cfu-proj-struct/cfu-proj-struct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">CFU-Playground 工程结构</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#some-c" id="toc-some-c" class="nav-link active" data-scroll-target="#some-c">Some C++</a>
  <ul class="collapse">
  <li><a href="#c-basics" id="toc-c-basics" class="nav-link" data-scroll-target="#c-basics">C++ Basics</a></li>
  <li><a href="#memory-management-内存管理" id="toc-memory-management-内存管理" class="nav-link" data-scroll-target="#memory-management-内存管理">Memory Management 内存管理</a></li>
  <li><a href="#class-类" id="toc-class-类" class="nav-link" data-scroll-target="#class-类">Class 类</a></li>
  <li><a href="#alias-别名" id="toc-alias-别名" class="nav-link" data-scroll-target="#alias-别名">Alias 别名</a></li>
  <li><a href="#namespace-命名空间" id="toc-namespace-命名空间" class="nav-link" data-scroll-target="#namespace-命名空间">Namespace 命名空间</a></li>
  <li><a href="#常见库用法" id="toc-常见库用法" class="nav-link" data-scroll-target="#常见库用法">常见库用法</a></li>
  </ul></li>
  <li><a href="#pybind11" id="toc-pybind11" class="nav-link" data-scroll-target="#pybind11">Pybind11</a></li>
  <li><a href="#cmake" id="toc-cmake" class="nav-link" data-scroll-target="#cmake">CMake</a>
  <ul class="collapse">
  <li><a href="#cmakelists" id="toc-cmakelists" class="nav-link" data-scroll-target="#cmakelists">CMakeLists</a></li>
  <li><a href="#makefile" id="toc-makefile" class="nav-link" data-scroll-target="#makefile">Makefile</a></li>
  </ul></li>
  <li><a href="#coding-techniques" id="toc-coding-techniques" class="nav-link" data-scroll-target="#coding-techniques">Coding Techniques</a>
  <ul class="collapse">
  <li><a href="#正负无穷" id="toc-正负无穷" class="nav-link" data-scroll-target="#正负无穷">正负无穷</a></li>
  <li><a href="#向上取整转为向下取整" id="toc-向上取整转为向下取整" class="nav-link" data-scroll-target="#向上取整转为向下取整">向上取整转为向下取整</a></li>
  <li><a href="#链式调用" id="toc-链式调用" class="nav-link" data-scroll-target="#链式调用">链式调用</a></li>
  </ul></li>
  <li><a href="#coding-habits" id="toc-coding-habits" class="nav-link" data-scroll-target="#coding-habits">Coding Habits</a>
  <ul class="collapse">
  <li><a href="#代码风格" id="toc-代码风格" class="nav-link" data-scroll-target="#代码风格">代码风格</a></li>
  <li><a href="#getters-和-setters" id="toc-getters-和-setters" class="nav-link" data-scroll-target="#getters-和-setters">getters 和 Setters</a></li>
  <li><a href="#常写-const" id="toc-常写-const" class="nav-link" data-scroll-target="#常写-const">常写 <code>const</code></a></li>
  </ul></li>
  <li><a href="#tips-on-code-reading" id="toc-tips-on-code-reading" class="nav-link" data-scroll-target="#tips-on-code-reading">Tips on Code Reading</a>
  <ul class="collapse">
  <li><a href="#first-encounter" id="toc-first-encounter" class="nav-link" data-scroll-target="#first-encounter">First Encounter</a></li>
  </ul></li>
  <li><a href="#verilog" id="toc-verilog" class="nav-link" data-scroll-target="#verilog">Verilog</a>
  <ul class="collapse">
  <li><a href="#verilog-testbench" id="toc-verilog-testbench" class="nav-link" data-scroll-target="#verilog-testbench">Verilog Testbench</a></li>
  </ul></li>
  <li><a href="#chisel" id="toc-chisel" class="nav-link" data-scroll-target="#chisel">Chisel</a>
  <ul class="collapse">
  <li><a href="#area-optimization-面积优化方法" id="toc-area-optimization-面积优化方法" class="nav-link" data-scroll-target="#area-optimization-面积优化方法">Area Optimization 面积优化方法</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../c-riscv-asm/c-riscv-asm.html">Crash Courses</a></li><li class="breadcrumb-item"><a href="../cc-coding/cc-coding.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Random Notes on Coding</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Random Notes on Coding</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="some-c" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="some-c">Some C++</h2>
<section id="c-basics" class="level3">
<h3 class="anchored" data-anchor-id="c-basics">C++ Basics</h3>
<section id="inline-关键字" class="level4">
<h4 class="anchored" data-anchor-id="inline-关键字"><code>inline</code> 关键字</h4>
<ul>
<li><p>允许重复定义 (如果你要在头文件里<strong>定义</strong> (而不是声明) 函数最好加上 <code>inline</code>):</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>add.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-addcpp" data-filename="add.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-addcpp-1"><a href="#lst-addcpp-1" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span><span class="cf">return</span> a <span class="op">+</span> b<span class="op">;}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>避免函数调用开销, 如果 <code>add()</code> 用 <a href="#lst-addcpp" class="quarto-xref">Listing&nbsp;<span class="quarto-unresolved-ref">lst-addcpp</span></a> 来定义, 则:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> add<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>会被编译器展开成:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">5</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(当然这个函数由于过于简单, 如果不用 <code>inline</code>, 编译器也会自动优化掉函数调用开销).</p></li>
</ul>
</section>
<section id="命令行参数" class="level4">
<h4 class="anchored" data-anchor-id="命令行参数">命令行参数</h4>
<ul>
<li><code>argc</code>: Argument Count, 参数个数</li>
<li><code>argv</code>: Argument Vector, 参数列表 (字符串数组)</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>编译运行:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">g++</span> main.cpp <span class="at">-o</span> main</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./main</span> abc 999 test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>会有:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>argc <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>argv<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="st">"./main"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>argv<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">"abc"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>argv<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="st">"999"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>argv<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="st">"test"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="memory-management-内存管理" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="memory-management-内存管理">Memory Management 内存管理</h3>
<section id="new-关键字" class="level4">
<h4 class="anchored" data-anchor-id="new-关键字"><code>new</code> 关键字</h4>
<p><code>new</code> 用来在堆上分配内存:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">*</span> p <span class="op">=</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[</span><span class="dv">10</span><span class="op">];</span> <span class="co">// Allocate 10 integers on heap</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    p<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">*</span> i<span class="op">;</span> <span class="co">// Assign values</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">delete</span><span class="op">[]</span> p<span class="op">;</span> <span class="co">// Don't forget to free the memory!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>分配单个对象. 注意下面两行代码的唯一区别是 <code>malloc</code> <strong>没有调用 Constructor</strong>!</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>MyClass<span class="op">*</span> obj <span class="op">=</span> <span class="kw">new</span> MyClass<span class="op">();</span> <span class="co">// Allocate single object</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>MyClass<span class="op">*</span> obj2 <span class="op">=</span> <span class="op">(</span>MyClass<span class="op">*)</span>malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>MyClass<span class="op">));</span> <span class="co">// C-style allocation</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">delete</span> obj<span class="op">;</span> <span class="co">// Free the memory!</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>free<span class="op">(</span>obj2<span class="op">);</span> <span class="co">// Free C-style allocated memory</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="smart-pointers-智能指针" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="smart-pointers-智能指针">Smart Pointers 智能指针</h4>
<p>Smart Pointers = <code>new</code> without <code>delete</code>. 即不需要担心内存泄漏问题.</p>
<ul>
<li><p><code>std::unique_ptr&lt;T&gt;</code>: 不能被复制:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>unique_ptr<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> p1 <span class="op">=</span> <span class="bu">std::</span>make_unique<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;(</span><span class="dv">42</span><span class="op">);</span> <span class="co">// Create unique_ptr</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">// std::unique_ptr&lt;int&gt; p2 = p1; // Error: cannot copy unique_ptr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><code>std::shared_ptr&lt;T&gt;</code>: 可以被复制 (用过引用计数来管理内存).</p></li>
<li><p><code>std::weak_ptr&lt;T&gt;</code>: 不会增加引用计数, 用于解决 <code>shared_ptr</code> 循环引用问题 (<a href="#fig-cirref" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-cirref</span></a>, <code>a1</code> 表示 <code>a</code> 的引用计数为 1 (<code>a.use_count() == 1</code>)):</p></li>
</ul>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-cirref" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cirref-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="cirref.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cirref-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: 循环引用问题
</figcaption>
</figure>
</div>
</div></div><div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>sharedptr.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-sharedptrcpp" data-filename="sharedptr.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-sharedptrcpp-1"><a href="#lst-sharedptrcpp-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;memory&gt;</span></span>
<span id="lst-sharedptrcpp-2"><a href="#lst-sharedptrcpp-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-sharedptrcpp-3"><a href="#lst-sharedptrcpp-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-sharedptrcpp-4"><a href="#lst-sharedptrcpp-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> B<span class="op">;</span> <span class="co">// Let A know B</span></span>
<span id="lst-sharedptrcpp-5"><a href="#lst-sharedptrcpp-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-sharedptrcpp-6"><a href="#lst-sharedptrcpp-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A <span class="op">{</span></span>
<span id="lst-sharedptrcpp-7"><a href="#lst-sharedptrcpp-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-sharedptrcpp-8"><a href="#lst-sharedptrcpp-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>shared_ptr<span class="op">&lt;</span>B<span class="op">&gt;</span> bptr<span class="op">;</span></span>
<span id="lst-sharedptrcpp-9"><a href="#lst-sharedptrcpp-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">~</span>A<span class="op">()</span> <span class="op">{</span> <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"A destroyed</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span> <span class="op">}</span></span>
<span id="lst-sharedptrcpp-10"><a href="#lst-sharedptrcpp-10" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-sharedptrcpp-11"><a href="#lst-sharedptrcpp-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-sharedptrcpp-12"><a href="#lst-sharedptrcpp-12" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> B <span class="op">{</span></span>
<span id="lst-sharedptrcpp-13"><a href="#lst-sharedptrcpp-13" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-sharedptrcpp-14"><a href="#lst-sharedptrcpp-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>shared_ptr<span class="op">&lt;</span>A<span class="op">&gt;</span> aptr<span class="op">;</span></span>
<span id="lst-sharedptrcpp-15"><a href="#lst-sharedptrcpp-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">~</span>B<span class="op">()</span> <span class="op">{</span> <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"B destroyed</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span> <span class="op">}</span></span>
<span id="lst-sharedptrcpp-16"><a href="#lst-sharedptrcpp-16" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-sharedptrcpp-17"><a href="#lst-sharedptrcpp-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-sharedptrcpp-18"><a href="#lst-sharedptrcpp-18" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-sharedptrcpp-19"><a href="#lst-sharedptrcpp-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a <span class="op">=</span> <span class="bu">std::</span>make_shared<span class="op">&lt;</span>A<span class="op">&gt;();</span> <span class="co">// a1</span></span>
<span id="lst-sharedptrcpp-20"><a href="#lst-sharedptrcpp-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b <span class="op">=</span> <span class="bu">std::</span>make_shared<span class="op">&lt;</span>B<span class="op">&gt;();</span> <span class="co">// b1</span></span>
<span id="lst-sharedptrcpp-21"><a href="#lst-sharedptrcpp-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-sharedptrcpp-22"><a href="#lst-sharedptrcpp-22" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>bptr <span class="op">=</span> b<span class="op">;</span> <span class="co">// b2</span></span>
<span id="lst-sharedptrcpp-23"><a href="#lst-sharedptrcpp-23" aria-hidden="true" tabindex="-1"></a>    b<span class="op">-&gt;</span>aptr <span class="op">=</span> a<span class="op">;</span> <span class="co">// a2</span></span>
<span id="lst-sharedptrcpp-24"><a href="#lst-sharedptrcpp-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-sharedptrcpp-25"><a href="#lst-sharedptrcpp-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// No destroy messages!!! (Memory leak)</span></span>
<span id="lst-sharedptrcpp-26"><a href="#lst-sharedptrcpp-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// b1 a1 (not 0!)</span></span>
<span id="lst-sharedptrcpp-27"><a href="#lst-sharedptrcpp-27" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>weakptr.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-weakptr" data-filename="weakptr.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-weakptr-1"><a href="#lst-weakptr-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;memory&gt;</span></span>
<span id="lst-weakptr-2"><a href="#lst-weakptr-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-weakptr-3"><a href="#lst-weakptr-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-weakptr-4"><a href="#lst-weakptr-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> B<span class="op">;</span> <span class="co">// Let A know B</span></span>
<span id="lst-weakptr-5"><a href="#lst-weakptr-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-weakptr-6"><a href="#lst-weakptr-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A <span class="op">{</span></span>
<span id="lst-weakptr-7"><a href="#lst-weakptr-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-weakptr-8"><a href="#lst-weakptr-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>weak_ptr<span class="op">&lt;</span>B<span class="op">&gt;</span> bptr<span class="op">;</span></span>
<span id="lst-weakptr-9"><a href="#lst-weakptr-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">~</span>A<span class="op">()</span> <span class="op">{</span> <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"A destroyed</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span> <span class="op">}</span></span>
<span id="lst-weakptr-10"><a href="#lst-weakptr-10" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-weakptr-11"><a href="#lst-weakptr-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-weakptr-12"><a href="#lst-weakptr-12" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> B <span class="op">{</span></span>
<span id="lst-weakptr-13"><a href="#lst-weakptr-13" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-weakptr-14"><a href="#lst-weakptr-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>weak_ptr<span class="op">&lt;</span>A<span class="op">&gt;</span> aptr<span class="op">;</span></span>
<span id="lst-weakptr-15"><a href="#lst-weakptr-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">~</span>B<span class="op">()</span> <span class="op">{</span> <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"B destroyed</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span> <span class="op">}</span></span>
<span id="lst-weakptr-16"><a href="#lst-weakptr-16" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-weakptr-17"><a href="#lst-weakptr-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-weakptr-18"><a href="#lst-weakptr-18" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-weakptr-19"><a href="#lst-weakptr-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a <span class="op">=</span> <span class="bu">std::</span>make_shared<span class="op">&lt;</span>A<span class="op">&gt;();</span> <span class="co">// a1</span></span>
<span id="lst-weakptr-20"><a href="#lst-weakptr-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b <span class="op">=</span> <span class="bu">std::</span>make_shared<span class="op">&lt;</span>B<span class="op">&gt;();</span> <span class="co">// b1</span></span>
<span id="lst-weakptr-21"><a href="#lst-weakptr-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-weakptr-22"><a href="#lst-weakptr-22" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>bptr <span class="op">=</span> b<span class="op">;</span> <span class="co">// b1 still</span></span>
<span id="lst-weakptr-23"><a href="#lst-weakptr-23" aria-hidden="true" tabindex="-1"></a>    b<span class="op">-&gt;</span>aptr <span class="op">=</span> a<span class="op">;</span> <span class="co">// a1 still</span></span>
<span id="lst-weakptr-24"><a href="#lst-weakptr-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-weakptr-25"><a href="#lst-weakptr-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Destroy properly</span></span>
<span id="lst-weakptr-26"><a href="#lst-weakptr-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// a0 b0</span></span>
<span id="lst-weakptr-27"><a href="#lst-weakptr-27" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="class-类" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="class-类">Class 类</h3>
<section id="constructor-init-list-构造函数与初始化列表" class="level4">
<h4 class="anchored" data-anchor-id="constructor-init-list-构造函数与初始化列表">Constructor, Init List 构造函数与初始化列表</h4>
<ul>
<li><strong>Constructor</strong>: 相当于 <code>Python</code> 里的 <code>__init__</code> 方法. 每次创建对象时会被调用. 可以有多个 Constructor (根据是否带参数区分). 名字是 <code>ClassName()</code>.
<ul>
<li><strong>Destructor</strong>: 相当于 <code>Python</code> 里的 <code>__del__</code> 方法. 每次对象被销毁时会被调用. 名字是 <code>~ClassName()</code>.</li>
</ul></li>
<li><strong>Constructor member initializer list</strong>: 用于在 Constructor 体<strong>执行前</strong>初始化成员变量 (用 <code>:</code> 引出). 那跟放在 Constructor 体里初始化有什么区别呢? 见下面例子:</li>
</ul>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>constructor.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-constructorcpp" data-filename="constructor.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-constructorcpp-1"><a href="#lst-constructorcpp-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-constructorcpp-2"><a href="#lst-constructorcpp-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span>
<span id="lst-constructorcpp-3"><a href="#lst-constructorcpp-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-constructorcpp-4"><a href="#lst-constructorcpp-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Small </span>
<span id="lst-constructorcpp-5"><a href="#lst-constructorcpp-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="lst-constructorcpp-6"><a href="#lst-constructorcpp-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-constructorcpp-7"><a href="#lst-constructorcpp-7" aria-hidden="true" tabindex="-1"></a>    Small<span class="op">()</span></span>
<span id="lst-constructorcpp-8"><a href="#lst-constructorcpp-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-constructorcpp-9"><a href="#lst-constructorcpp-9" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="lst-constructorcpp-10"><a href="#lst-constructorcpp-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-constructorcpp-11"><a href="#lst-constructorcpp-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-constructorcpp-12"><a href="#lst-constructorcpp-12" aria-hidden="true" tabindex="-1"></a>    Small<span class="op">(</span><span class="dt">int</span> in<span class="op">)</span></span>
<span id="lst-constructorcpp-13"><a href="#lst-constructorcpp-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-constructorcpp-14"><a href="#lst-constructorcpp-14" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="dv">2</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="lst-constructorcpp-15"><a href="#lst-constructorcpp-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-constructorcpp-16"><a href="#lst-constructorcpp-16" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-constructorcpp-17"><a href="#lst-constructorcpp-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-constructorcpp-18"><a href="#lst-constructorcpp-18" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Big</span>
<span id="lst-constructorcpp-19"><a href="#lst-constructorcpp-19" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="lst-constructorcpp-20"><a href="#lst-constructorcpp-20" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="lst-constructorcpp-21"><a href="#lst-constructorcpp-21" aria-hidden="true" tabindex="-1"></a>    Small small<span class="op">;</span></span>
<span id="lst-constructorcpp-22"><a href="#lst-constructorcpp-22" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-constructorcpp-23"><a href="#lst-constructorcpp-23" aria-hidden="true" tabindex="-1"></a>    Big<span class="op">(</span><span class="dt">int</span> in<span class="op">)</span></span>
<span id="lst-constructorcpp-24"><a href="#lst-constructorcpp-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-constructorcpp-25"><a href="#lst-constructorcpp-25" aria-hidden="true" tabindex="-1"></a>        small <span class="op">=</span> Small<span class="op">(</span>in<span class="op">);</span></span>
<span id="lst-constructorcpp-26"><a href="#lst-constructorcpp-26" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="dv">3</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span> </span>
<span id="lst-constructorcpp-27"><a href="#lst-constructorcpp-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-constructorcpp-28"><a href="#lst-constructorcpp-28" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-constructorcpp-29"><a href="#lst-constructorcpp-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-constructorcpp-30"><a href="#lst-constructorcpp-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="lst-constructorcpp-31"><a href="#lst-constructorcpp-31" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="lst-constructorcpp-32"><a href="#lst-constructorcpp-32" aria-hidden="true" tabindex="-1"></a>    Big big<span class="op">(</span><span class="dv">7</span><span class="op">);</span> <span class="co">// Output: 1 2 3</span></span>
<span id="lst-constructorcpp-33"><a href="#lst-constructorcpp-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-constructorcpp-34"><a href="#lst-constructorcpp-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-constructorcpp-35"><a href="#lst-constructorcpp-35" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>constructor_init.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-constructorinitcpp" data-filename="constructor_init.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-constructorinitcpp-1"><a href="#lst-constructorinitcpp-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-constructorinitcpp-2"><a href="#lst-constructorinitcpp-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span>
<span id="lst-constructorinitcpp-3"><a href="#lst-constructorinitcpp-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-constructorinitcpp-4"><a href="#lst-constructorinitcpp-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Small </span>
<span id="lst-constructorinitcpp-5"><a href="#lst-constructorinitcpp-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="lst-constructorinitcpp-6"><a href="#lst-constructorinitcpp-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-constructorinitcpp-7"><a href="#lst-constructorinitcpp-7" aria-hidden="true" tabindex="-1"></a>    Small<span class="op">()</span></span>
<span id="lst-constructorinitcpp-8"><a href="#lst-constructorinitcpp-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-constructorinitcpp-9"><a href="#lst-constructorinitcpp-9" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="lst-constructorinitcpp-10"><a href="#lst-constructorinitcpp-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-constructorinitcpp-11"><a href="#lst-constructorinitcpp-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-constructorinitcpp-12"><a href="#lst-constructorinitcpp-12" aria-hidden="true" tabindex="-1"></a>    Small<span class="op">(</span><span class="dt">int</span> in<span class="op">)</span></span>
<span id="lst-constructorinitcpp-13"><a href="#lst-constructorinitcpp-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-constructorinitcpp-14"><a href="#lst-constructorinitcpp-14" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="dv">2</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="lst-constructorinitcpp-15"><a href="#lst-constructorinitcpp-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-constructorinitcpp-16"><a href="#lst-constructorinitcpp-16" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-constructorinitcpp-17"><a href="#lst-constructorinitcpp-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-constructorinitcpp-18"><a href="#lst-constructorinitcpp-18" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Big</span>
<span id="lst-constructorinitcpp-19"><a href="#lst-constructorinitcpp-19" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="lst-constructorinitcpp-20"><a href="#lst-constructorinitcpp-20" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="lst-constructorinitcpp-21"><a href="#lst-constructorinitcpp-21" aria-hidden="true" tabindex="-1"></a>    Small small<span class="op">;</span></span>
<span id="lst-constructorinitcpp-22"><a href="#lst-constructorinitcpp-22" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-constructorinitcpp-23"><a href="#lst-constructorinitcpp-23" aria-hidden="true" tabindex="-1"></a>    Big<span class="op">(</span><span class="dt">int</span> in<span class="op">)</span> </span>
<span id="lst-constructorinitcpp-24"><a href="#lst-constructorinitcpp-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span> small<span class="op">(</span>in<span class="op">)</span></span>
<span id="lst-constructorinitcpp-25"><a href="#lst-constructorinitcpp-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-constructorinitcpp-26"><a href="#lst-constructorinitcpp-26" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="dv">3</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span> </span>
<span id="lst-constructorinitcpp-27"><a href="#lst-constructorinitcpp-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-constructorinitcpp-28"><a href="#lst-constructorinitcpp-28" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-constructorinitcpp-29"><a href="#lst-constructorinitcpp-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-constructorinitcpp-30"><a href="#lst-constructorinitcpp-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="lst-constructorinitcpp-31"><a href="#lst-constructorinitcpp-31" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="lst-constructorinitcpp-32"><a href="#lst-constructorinitcpp-32" aria-hidden="true" tabindex="-1"></a>    Big big<span class="op">(</span><span class="dv">7</span><span class="op">);</span> <span class="co">// Output: 2 3</span></span>
<span id="lst-constructorinitcpp-33"><a href="#lst-constructorinitcpp-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-constructorinitcpp-34"><a href="#lst-constructorinitcpp-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-constructorinitcpp-35"><a href="#lst-constructorinitcpp-35" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="this-指针" class="level4">
<h4 class="anchored" data-anchor-id="this-指针"><code>this</code> 指针</h4>
<p>就是 <code>Python</code> 里的 <code>self</code> (当前对象的地址):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setX<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">-&gt;</span>x <span class="op">=</span> x<span class="op">;</span>   <span class="co">// Left: member variable; Right: parameter</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="类继承" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="类继承">类继承</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A <span class="op">:</span> <span class="kw">public</span> B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>上面代码表示让 <code>class A</code> 继承 <code>class B</code>. <code>public</code> 表示<strong>公开继承</strong>, 即 <code>B</code> 的 <code>public</code> 和 <code>protected</code> 成员在 <code>A</code> 里依然是 <code>public</code> 和 <code>protected</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;<code>protected</code> 和 <code>private</code> 区别: 前者代表本类和子类可以访问, 后者只能本类访问 (子类不行).</p></div></div></section>
<section id="friend-关键字" class="level4">
<h4 class="anchored" data-anchor-id="friend-关键字"><code>friend</code> 关键字</h4>
<p>在一个类里面声明另一个类 (或函数) 为 <code>friend</code>, 表示同意它访问自己的 <code>private</code> 和 <code>protected</code> 成员 (注意是谁访问谁的私有成员!):</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>friend.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-friendcpp" data-filename="friend.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-friendcpp-1"><a href="#lst-friendcpp-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-friendcpp-2"><a href="#lst-friendcpp-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-friendcpp-3"><a href="#lst-friendcpp-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> B<span class="op">;</span>  <span class="co">// Tell compiler that B exists</span></span>
<span id="lst-friendcpp-4"><a href="#lst-friendcpp-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-friendcpp-5"><a href="#lst-friendcpp-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A <span class="op">{</span></span>
<span id="lst-friendcpp-6"><a href="#lst-friendcpp-6" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="lst-friendcpp-7"><a href="#lst-friendcpp-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> secret <span class="op">=</span> <span class="dv">7</span><span class="op">;</span></span>
<span id="lst-friendcpp-8"><a href="#lst-friendcpp-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-friendcpp-9"><a href="#lst-friendcpp-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">friend</span> <span class="kw">class</span> B<span class="op">;</span> <span class="co">// B is an intimate friend of A</span></span>
<span id="lst-friendcpp-10"><a href="#lst-friendcpp-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// friend B;    // Alternative</span></span>
<span id="lst-friendcpp-11"><a href="#lst-friendcpp-11" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-friendcpp-12"><a href="#lst-friendcpp-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-friendcpp-13"><a href="#lst-friendcpp-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> B <span class="op">{</span></span>
<span id="lst-friendcpp-14"><a href="#lst-friendcpp-14" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-friendcpp-15"><a href="#lst-friendcpp-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> reveal<span class="op">(</span>A<span class="op">&amp;</span> a<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-friendcpp-16"><a href="#lst-friendcpp-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> a<span class="op">.</span>secret <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="lst-friendcpp-17"><a href="#lst-friendcpp-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-friendcpp-18"><a href="#lst-friendcpp-18" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-friendcpp-19"><a href="#lst-friendcpp-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-friendcpp-20"><a href="#lst-friendcpp-20" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-friendcpp-21"><a href="#lst-friendcpp-21" aria-hidden="true" tabindex="-1"></a>    A a<span class="op">;</span></span>
<span id="lst-friendcpp-22"><a href="#lst-friendcpp-22" aria-hidden="true" tabindex="-1"></a>    B b<span class="op">;</span></span>
<span id="lst-friendcpp-23"><a href="#lst-friendcpp-23" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span>reveal<span class="op">(</span>a<span class="op">);</span> <span class="co">// Outputs: 7</span></span>
<span id="lst-friendcpp-24"><a href="#lst-friendcpp-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-friendcpp-25"><a href="#lst-friendcpp-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-friendcpp-26"><a href="#lst-friendcpp-26" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="alias-别名" class="level3">
<h3 class="anchored" data-anchor-id="alias-别名">Alias 别名</h3>
<section id="reference-引用" class="level4">
<h4 class="anchored" data-anchor-id="reference-引用">Reference 引用</h4>
<ul>
<li>Reference 仅仅是 Syntax sugar!</li>
<li>必须初始化. <code>int&amp; ref;</code> 是错误的.</li>
<li><code>int&amp; ref = a;</code> 在编译时不会出现 <code>ref</code> 这个变量, 它只是 <code>a</code> 的别名 (alias).</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>change_val_ref.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-changevalrefcpp" data-filename="change_val_ref.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-changevalrefcpp-1"><a href="#lst-changevalrefcpp-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-changevalrefcpp-2"><a href="#lst-changevalrefcpp-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="lst-changevalrefcpp-3"><a href="#lst-changevalrefcpp-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="lst-changevalrefcpp-4"><a href="#lst-changevalrefcpp-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="lst-changevalrefcpp-5"><a href="#lst-changevalrefcpp-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span><span class="op">&amp;</span> ref <span class="op">=</span> a<span class="op">;</span> <span class="co">// ref is an alias to a</span></span>
<span id="lst-changevalrefcpp-6"><a href="#lst-changevalrefcpp-6" aria-hidden="true" tabindex="-1"></a>    ref <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>     <span class="co">// Actually modifies a</span></span>
<span id="lst-changevalrefcpp-7"><a href="#lst-changevalrefcpp-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"a = "</span> <span class="op">&lt;&lt;</span> a <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span> <span class="co">// Outputs: a = 10</span></span>
<span id="lst-changevalrefcpp-8"><a href="#lst-changevalrefcpp-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-changevalrefcpp-9"><a href="#lst-changevalrefcpp-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-changevalrefcpp-10"><a href="#lst-changevalrefcpp-10" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>increment_val_ref.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-incrementvalrefcpp" data-filename="increment_val_ref.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-incrementvalrefcpp-1"><a href="#lst-incrementvalrefcpp-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-incrementvalrefcpp-2"><a href="#lst-incrementvalrefcpp-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> increment<span class="op">(</span><span class="dt">int</span><span class="op">&amp;</span> num<span class="op">)</span> <span class="op">{</span>num<span class="op">++;}</span></span>
<span id="lst-incrementvalrefcpp-3"><a href="#lst-incrementvalrefcpp-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="lst-incrementvalrefcpp-4"><a href="#lst-incrementvalrefcpp-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="lst-incrementvalrefcpp-5"><a href="#lst-incrementvalrefcpp-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="lst-incrementvalrefcpp-6"><a href="#lst-incrementvalrefcpp-6" aria-hidden="true" tabindex="-1"></a>    increment<span class="op">(</span>value<span class="op">);</span> <span class="co">// Pass by reference</span></span>
<span id="lst-incrementvalrefcpp-7"><a href="#lst-incrementvalrefcpp-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"value = "</span> <span class="op">&lt;&lt;</span> value <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span> <span class="co">// Outputs: value = 6</span></span>
<span id="lst-incrementvalrefcpp-8"><a href="#lst-incrementvalrefcpp-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-incrementvalrefcpp-9"><a href="#lst-incrementvalrefcpp-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-incrementvalrefcpp-10"><a href="#lst-incrementvalrefcpp-10" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="typedef-和-using-关键字" class="level4">
<h4 class="anchored" data-anchor-id="typedef-和-using-关键字"><code>typedef</code> 和 <code>using</code> 关键字</h4>
<p>下面两个都是给 <code>std::vector&lt;int&gt;</code> 起别名 <code>IntList</code>, 效果一样:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> IntList <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> IntList<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="overloading-重载" class="level4">
<h4 class="anchored" data-anchor-id="overloading-重载">Overloading 重载</h4>
<ul>
<li>重载使得 <code>+</code>, <code>*</code> 这些运算符可以用于自定义 class 之间的运算 (而不仅限于 <code>int</code>, <code>float</code> 等).</li>
<li><code>Python</code> 里面也有 <code>__add__</code> 这种魔法方法实现重载.</li>
<li>重载是不好的编程习惯! 但在写 API 的时候要提供重载和非重载两种接口供开发者使用 (比如下面的 <code>Add()</code> 和 <code>operator+()</code> 方法), 定义的时候可以用重载定义非重载, 也可以反过来:</li>
</ul>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>overload_op_calls_method.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-overload_op_calls_methodcpp" data-filename="overload_op_calls_method.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-overload_op_calls_methodcpp-1"><a href="#lst-overload_op_calls_methodcpp-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Point</span>
<span id="lst-overload_op_calls_methodcpp-2"><a href="#lst-overload_op_calls_methodcpp-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="lst-overload_op_calls_methodcpp-3"><a href="#lst-overload_op_calls_methodcpp-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-overload_op_calls_methodcpp-4"><a href="#lst-overload_op_calls_methodcpp-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="lst-overload_op_calls_methodcpp-5"><a href="#lst-overload_op_calls_methodcpp-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-overload_op_calls_methodcpp-6"><a href="#lst-overload_op_calls_methodcpp-6" aria-hidden="true" tabindex="-1"></a>    Point<span class="op">(</span><span class="dt">double</span> x_coor<span class="op">,</span> <span class="dt">double</span> y_coor<span class="op">)</span></span>
<span id="lst-overload_op_calls_methodcpp-7"><a href="#lst-overload_op_calls_methodcpp-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span> x<span class="op">(</span>x_coor<span class="op">),</span> y<span class="op">(</span>y_coor<span class="op">)</span> <span class="op">{}</span></span>
<span id="lst-overload_op_calls_methodcpp-8"><a href="#lst-overload_op_calls_methodcpp-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-overload_op_calls_methodcpp-9"><a href="#lst-overload_op_calls_methodcpp-9" aria-hidden="true" tabindex="-1"></a>    Point Add<span class="op">(</span><span class="at">const</span> Point<span class="op">&amp;</span> other<span class="op">)</span> <span class="at">const</span></span>
<span id="lst-overload_op_calls_methodcpp-10"><a href="#lst-overload_op_calls_methodcpp-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-overload_op_calls_methodcpp-11"><a href="#lst-overload_op_calls_methodcpp-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Point<span class="op">(</span>x <span class="op">+</span> other<span class="op">.</span>x<span class="op">,</span> y <span class="op">+</span> other<span class="op">.</span>y<span class="op">);</span></span>
<span id="lst-overload_op_calls_methodcpp-12"><a href="#lst-overload_op_calls_methodcpp-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-overload_op_calls_methodcpp-13"><a href="#lst-overload_op_calls_methodcpp-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-overload_op_calls_methodcpp-14"><a href="#lst-overload_op_calls_methodcpp-14" aria-hidden="true" tabindex="-1"></a>    Point <span class="kw">operator</span><span class="op">+(</span><span class="at">const</span> Point<span class="op">&amp;</span> other<span class="op">)</span> <span class="at">const</span></span>
<span id="lst-overload_op_calls_methodcpp-15"><a href="#lst-overload_op_calls_methodcpp-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-overload_op_calls_methodcpp-16"><a href="#lst-overload_op_calls_methodcpp-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Add<span class="op">(</span>other<span class="op">);</span></span>
<span id="lst-overload_op_calls_methodcpp-17"><a href="#lst-overload_op_calls_methodcpp-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-overload_op_calls_methodcpp-18"><a href="#lst-overload_op_calls_methodcpp-18" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-overload_op_calls_methodcpp-19"><a href="#lst-overload_op_calls_methodcpp-19" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>overload_method_calls_op.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-overload_method_calls_opcpp" data-filename="overload_method_calls_op.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-overload_method_calls_opcpp-1"><a href="#lst-overload_method_calls_opcpp-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Point</span>
<span id="lst-overload_method_calls_opcpp-2"><a href="#lst-overload_method_calls_opcpp-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="lst-overload_method_calls_opcpp-3"><a href="#lst-overload_method_calls_opcpp-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-overload_method_calls_opcpp-4"><a href="#lst-overload_method_calls_opcpp-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="lst-overload_method_calls_opcpp-5"><a href="#lst-overload_method_calls_opcpp-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-overload_method_calls_opcpp-6"><a href="#lst-overload_method_calls_opcpp-6" aria-hidden="true" tabindex="-1"></a>    Point<span class="op">(</span><span class="dt">double</span> x_coor<span class="op">,</span> <span class="dt">double</span> y_coor<span class="op">)</span></span>
<span id="lst-overload_method_calls_opcpp-7"><a href="#lst-overload_method_calls_opcpp-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span> x<span class="op">(</span>x_coor<span class="op">),</span> y<span class="op">(</span>y_coor<span class="op">)</span> <span class="op">{}</span></span>
<span id="lst-overload_method_calls_opcpp-8"><a href="#lst-overload_method_calls_opcpp-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-overload_method_calls_opcpp-9"><a href="#lst-overload_method_calls_opcpp-9" aria-hidden="true" tabindex="-1"></a>    Point Add<span class="op">(</span><span class="at">const</span> Point<span class="op">&amp;</span> other<span class="op">)</span> <span class="at">const</span></span>
<span id="lst-overload_method_calls_opcpp-10"><a href="#lst-overload_method_calls_opcpp-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-overload_method_calls_opcpp-11"><a href="#lst-overload_method_calls_opcpp-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span> <span class="op">+</span> other<span class="op">;</span></span>
<span id="lst-overload_method_calls_opcpp-12"><a href="#lst-overload_method_calls_opcpp-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-overload_method_calls_opcpp-13"><a href="#lst-overload_method_calls_opcpp-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-overload_method_calls_opcpp-14"><a href="#lst-overload_method_calls_opcpp-14" aria-hidden="true" tabindex="-1"></a>    Point <span class="kw">operator</span><span class="op">+(</span><span class="at">const</span> Point<span class="op">&amp;</span> other<span class="op">)</span> <span class="at">const</span></span>
<span id="lst-overload_method_calls_opcpp-15"><a href="#lst-overload_method_calls_opcpp-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-overload_method_calls_opcpp-16"><a href="#lst-overload_method_calls_opcpp-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Point<span class="op">(</span>x <span class="op">+</span> other<span class="op">.</span>x<span class="op">,</span> y <span class="op">+</span> other<span class="op">.</span>y<span class="op">);</span></span>
<span id="lst-overload_method_calls_opcpp-17"><a href="#lst-overload_method_calls_opcpp-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-overload_method_calls_opcpp-18"><a href="#lst-overload_method_calls_opcpp-18" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-overload_method_calls_opcpp-19"><a href="#lst-overload_method_calls_opcpp-19" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>这样就可以直接这样来将两个 <code>Point</code> 对象相加:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>overload_main.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-overloadmaincpp" data-filename="overload_main.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-overloadmaincpp-1"><a href="#lst-overloadmaincpp-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-overloadmaincpp-2"><a href="#lst-overloadmaincpp-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"overload_op_calls_method.cpp"</span></span>
<span id="lst-overloadmaincpp-3"><a href="#lst-overloadmaincpp-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-overloadmaincpp-4"><a href="#lst-overloadmaincpp-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="lst-overloadmaincpp-5"><a href="#lst-overloadmaincpp-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="lst-overloadmaincpp-6"><a href="#lst-overloadmaincpp-6" aria-hidden="true" tabindex="-1"></a>    Point p1<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">2.0</span><span class="op">);</span></span>
<span id="lst-overloadmaincpp-7"><a href="#lst-overloadmaincpp-7" aria-hidden="true" tabindex="-1"></a>    Point p2<span class="op">(</span><span class="fl">3.0</span><span class="op">,</span> <span class="fl">4.0</span><span class="op">);</span></span>
<span id="lst-overloadmaincpp-8"><a href="#lst-overloadmaincpp-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-overloadmaincpp-9"><a href="#lst-overloadmaincpp-9" aria-hidden="true" tabindex="-1"></a>    Point p3 <span class="op">=</span> p1 <span class="op">+</span> p2<span class="op">;</span>  <span class="co">// i.e., p3 = p1.operator+(p2);</span></span>
<span id="lst-overloadmaincpp-10"><a href="#lst-overloadmaincpp-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"p3: ("</span> <span class="op">&lt;&lt;</span> p3<span class="op">.</span>x <span class="op">&lt;&lt;</span> <span class="st">", "</span> <span class="op">&lt;&lt;</span> p3<span class="op">.</span>y <span class="op">&lt;&lt;</span> <span class="st">")</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span> <span class="co">// p3: (4, 6)</span></span>
<span id="lst-overloadmaincpp-11"><a href="#lst-overloadmaincpp-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-overloadmaincpp-12"><a href="#lst-overloadmaincpp-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-overloadmaincpp-13"><a href="#lst-overloadmaincpp-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-overloadmaincpp-14"><a href="#lst-overloadmaincpp-14" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="namespace-命名空间" class="level3">
<h3 class="anchored" data-anchor-id="namespace-命名空间">Namespace 命名空间</h3>
<ul>
<li>我们希望在不同的场景中给功能类似的函数起<strong>完全相同的名字</strong> (比如下面例子的 <code>print()</code> 函数), 为了<strong>避免命名冲突</strong>, 我们可以使用 <code>namespace</code>:</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>namespace.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-namespacecpp" data-filename="namespace.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-namespacecpp-1"><a href="#lst-namespacecpp-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-namespacecpp-2"><a href="#lst-namespacecpp-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-namespacecpp-3"><a href="#lst-namespacecpp-3" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> AppleSpace <span class="op">{</span> <span class="kw">namespace</span> GoodApple <span class="op">{</span></span>
<span id="lst-namespacecpp-4"><a href="#lst-namespacecpp-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> print<span class="op">(</span><span class="at">const</span> <span class="dt">char</span><span class="op">*</span> msg<span class="op">)</span></span>
<span id="lst-namespacecpp-5"><a href="#lst-namespacecpp-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-namespacecpp-6"><a href="#lst-namespacecpp-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Goodapple "</span> <span class="op">&lt;&lt;</span> msg <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="lst-namespacecpp-7"><a href="#lst-namespacecpp-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-namespacecpp-8"><a href="#lst-namespacecpp-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>   <span class="kw">namespace</span> BadApple <span class="op">{</span></span>
<span id="lst-namespacecpp-9"><a href="#lst-namespacecpp-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> print<span class="op">(</span><span class="at">const</span> <span class="dt">char</span><span class="op">*</span> msg<span class="op">)</span></span>
<span id="lst-namespacecpp-10"><a href="#lst-namespacecpp-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-namespacecpp-11"><a href="#lst-namespacecpp-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Badapple "</span> <span class="op">&lt;&lt;</span> msg <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="lst-namespacecpp-12"><a href="#lst-namespacecpp-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-namespacecpp-13"><a href="#lst-namespacecpp-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="op">}</span></span>
<span id="lst-namespacecpp-14"><a href="#lst-namespacecpp-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-namespacecpp-15"><a href="#lst-namespacecpp-15" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> OrangeSpace <span class="op">{</span></span>
<span id="lst-namespacecpp-16"><a href="#lst-namespacecpp-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> print<span class="op">(</span><span class="at">const</span> <span class="dt">char</span><span class="op">*</span> msg<span class="op">)</span></span>
<span id="lst-namespacecpp-17"><a href="#lst-namespacecpp-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-namespacecpp-18"><a href="#lst-namespacecpp-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Orange "</span> <span class="op">&lt;&lt;</span> msg <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="lst-namespacecpp-19"><a href="#lst-namespacecpp-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-namespacecpp-20"><a href="#lst-namespacecpp-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-namespacecpp-21"><a href="#lst-namespacecpp-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-namespacecpp-22"><a href="#lst-namespacecpp-22" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-namespacecpp-23"><a href="#lst-namespacecpp-23" aria-hidden="true" tabindex="-1"></a>    AppleSpace<span class="op">::</span>GoodApple<span class="op">::</span>print<span class="op">(</span><span class="st">"Hello"</span><span class="op">);</span></span>
<span id="lst-namespacecpp-24"><a href="#lst-namespacecpp-24" aria-hidden="true" tabindex="-1"></a>    AppleSpace<span class="op">::</span>BadApple<span class="op">::</span>print<span class="op">(</span><span class="st">"Hello"</span><span class="op">);</span></span>
<span id="lst-namespacecpp-25"><a href="#lst-namespacecpp-25" aria-hidden="true" tabindex="-1"></a>    OrangeSpace<span class="op">::</span>print<span class="op">(</span><span class="st">"Hello"</span><span class="op">);</span></span>
<span id="lst-namespacecpp-26"><a href="#lst-namespacecpp-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-namespacecpp-27"><a href="#lst-namespacecpp-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-namespacecpp-28"><a href="#lst-namespacecpp-28" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>输出:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Goodapple Hello</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>Badapple Hello</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>Orange Hello</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>不要到处拉 <code>using namespace xxx;</code> 的 shit!</p></li>
<li><p>全局作用域运算符:</p></li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>globalnamespace.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-globalnamespacecpp" data-filename="globalnamespace.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-globalnamespacecpp-1"><a href="#lst-globalnamespacecpp-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-globalnamespacecpp-2"><a href="#lst-globalnamespacecpp-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-globalnamespacecpp-3"><a href="#lst-globalnamespacecpp-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> value <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>  <span class="co">// Global namespace value</span></span>
<span id="lst-globalnamespacecpp-4"><a href="#lst-globalnamespacecpp-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-globalnamespacecpp-5"><a href="#lst-globalnamespacecpp-5" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> A <span class="op">{</span></span>
<span id="lst-globalnamespacecpp-6"><a href="#lst-globalnamespacecpp-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value <span class="op">=</span> <span class="dv">20</span><span class="op">;</span>  <span class="co">// A::value</span></span>
<span id="lst-globalnamespacecpp-7"><a href="#lst-globalnamespacecpp-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-globalnamespacecpp-8"><a href="#lst-globalnamespacecpp-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> print<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-globalnamespacecpp-9"><a href="#lst-globalnamespacecpp-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> value <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span>      <span class="co">// Output 20</span></span>
<span id="lst-globalnamespacecpp-10"><a href="#lst-globalnamespacecpp-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="op">::</span>value <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span>    <span class="co">// Output 10</span></span>
<span id="lst-globalnamespacecpp-11"><a href="#lst-globalnamespacecpp-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-globalnamespacecpp-12"><a href="#lst-globalnamespacecpp-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-globalnamespacecpp-13"><a href="#lst-globalnamespacecpp-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-globalnamespacecpp-14"><a href="#lst-globalnamespacecpp-14" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-globalnamespacecpp-15"><a href="#lst-globalnamespacecpp-15" aria-hidden="true" tabindex="-1"></a>    A<span class="op">::</span>print<span class="op">();</span></span>
<span id="lst-globalnamespacecpp-16"><a href="#lst-globalnamespacecpp-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-globalnamespacecpp-17"><a href="#lst-globalnamespacecpp-17" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>::</code> 可用于<strong>调用</strong> namespace 里的函数 或 class 里的 <code>static</code> 变量或方法. 在外部<strong>定义</strong>类的方法实现时必须用 <code>::</code> (调用时用 <code>.</code>).</li>
</ul>
<!-- ### Anonymous Functions (Lambda Expressions) -->
</section>
<section id="常见库用法" class="level3">
<h3 class="anchored" data-anchor-id="常见库用法">常见库用法</h3>
<section id="stdcopy" class="level4">
<h4 class="anchored" data-anchor-id="stdcopy"><code>std::copy()</code></h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span><span class="pp">  </span><span class="co">// std::copy</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> src <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">};</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> dst<span class="op">(</span><span class="dv">5</span><span class="op">);</span>   <span class="co">// Must arrange space in advance</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>copy<span class="op">(</span>src<span class="op">.</span>begin<span class="op">(),</span> src<span class="op">.</span>end<span class="op">(),</span> dst<span class="op">.</span>begin<span class="op">());</span> <span class="co">// Copy src to dst</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="pybind11" class="level2">
<h2 class="anchored" data-anchor-id="pybind11">Pybind11</h2>
<p><code>Pybind11</code> 是一个 <code>C++</code> 库, 使得我们可以在 <code>Python</code> 代码中调用 <code>C++</code> 函数和类. 比如:</p>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>add_op.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-addopcpp" data-filename="add_op.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-addopcpp-1"><a href="#lst-addopcpp-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pybind11/pybind11.h&gt;</span></span>
<span id="lst-addopcpp-2"><a href="#lst-addopcpp-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-addopcpp-3"><a href="#lst-addopcpp-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-addopcpp-4"><a href="#lst-addopcpp-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="lst-addopcpp-5"><a href="#lst-addopcpp-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-addopcpp-6"><a href="#lst-addopcpp-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-addopcpp-7"><a href="#lst-addopcpp-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="an">@param</span><span class="co"> </span><span class="cv">ops</span><span class="co"> library name</span></span>
<span id="lst-addopcpp-8"><a href="#lst-addopcpp-8" aria-hidden="true" tabindex="-1"></a>PYBIND11_MODULE<span class="op">(</span>ops<span class="op">,</span> m<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-addopcpp-9"><a href="#lst-addopcpp-9" aria-hidden="true" tabindex="-1"></a>    m<span class="op">.</span>def<span class="op">(</span><span class="st">"add"</span><span class="op">,</span> <span class="op">&amp;</span>add<span class="op">);</span></span>
<span id="lst-addopcpp-10"><a href="#lst-addopcpp-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-addopcpp-11"><a href="#lst-addopcpp-11" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>main.py</strong></pre>
</div>
<div class="sourceCode" id="lst-mainpy" data-filename="main.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-mainpy-1"><a href="#lst-mainpy-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ops</span>
<span id="lst-mainpy-2"><a href="#lst-mainpy-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-mainpy-3"><a href="#lst-mainpy-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ops.add(<span class="dv">3</span>, <span class="dv">5</span>))</span>
<span id="lst-mainpy-4"><a href="#lst-mainpy-4" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>运行类似下面的命令:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">c++</span> <span class="at">-O3</span> <span class="at">-Wall</span> <span class="at">-shared</span> <span class="at">-std</span><span class="op">=</span>c++11 <span class="at">-fPIC</span> <span class="at">-undefined</span> dynamic_lookup <span class="dt">\</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">-I</span>/opt/homebrew/anaconda3/lib/python3.12/site-packages/pybind11/include <span class="dt">\</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">-I</span>/opt/homebrew/anaconda3/include/python3.12 <span class="dt">\</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    add_op.cpp <span class="at">-o</span> ops.cpython-312-darwin.so</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> main.py <span class="co"># output 8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>第一个命令会在当前目录下产生一个 <code>.so</code> (shared object) 文件. 运行 <code>python main.py</code> 的时候在 <code>import ops</code> 的时候, <code>Python</code> 会在 <code>.so</code> 文件中找到 <code>add</code> 函数.</p>
</section>
<section id="cmake" class="level2">
<h2 class="anchored" data-anchor-id="cmake">CMake</h2>
<section id="cmakelists" class="level3">
<h3 class="anchored" data-anchor-id="cmakelists">CMakeLists</h3>
</section>
<section id="makefile" class="level3">
<h3 class="anchored" data-anchor-id="makefile">Makefile</h3>
<ul>
<li><p>格式:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dv">target:</span><span class="dt"> prerequisites</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>recipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>缺省规则</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">.DEFAULT_GOAL</span> <span class="ch">:=</span><span class="st"> all</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="dv">all:</span><span class="dt"> ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>伪规则</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY:</span><span class="dt"> all clean</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Append:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">+=</span><span class="st"> -Wall -O2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>改后缀名:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="dt">SRCS_ASM</span> <span class="ch">=</span><span class="st"> start.S</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJS</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">SRCS_ASM</span><span class="kw">:</span><span class="ss">.S</span><span class="kw">=</span><span class="ss">.o</span><span class="ch">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>冒号前面和后面:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o :</span><span class="dt"> %.c</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>%</code> 为通配符, 意思是每当你需要一个 <code>.o</code> 文件, 并且当前目录下有对应的 <code>.c</code> 文件时, 就用下面的命令来生成它</li>
<li><code>$&lt;</code>: 第一个依赖文件</li>
<li><code>$@</code>: 目标文件</li>
<li><code>$^</code>: 所有依赖文件</li>
<li><code>$?</code>: 所有比目标文件新的依赖文件</li>
</ul></li>
</ul>
</section>
</section>
<section id="coding-techniques" class="level2">
<h2 class="anchored" data-anchor-id="coding-techniques">Coding Techniques</h2>
<section id="正负无穷" class="level3">
<h3 class="anchored" data-anchor-id="正负无穷">正负无穷</h3>
<p>涉及最小/最大值初始化. 例如我们要找 <code>arr</code> 中的最大值:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;float.h&gt;</span><span class="pp">   </span><span class="co">// for FLT_MAX</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> arr<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="fl">3.2</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.5</span><span class="op">,</span> <span class="fl">7.8</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">4.4</span><span class="op">};</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span>arr<span class="op">)</span> <span class="op">/</span> <span class="kw">sizeof</span><span class="op">(</span>arr<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> max_val <span class="op">=</span> <span class="op">-</span>FLT_MAX<span class="op">;</span>    <span class="co">// Initialize to -inf</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>arr<span class="op">[</span>i<span class="op">]</span> <span class="op">&gt;</span> max_val<span class="op">)</span>   max_val <span class="op">=</span> arr<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Max value: "</span> <span class="op">&lt;&lt;</span> max_val <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="向上取整转为向下取整" class="level3">
<h3 class="anchored" data-anchor-id="向上取整转为向下取整">向上取整转为向下取整</h3>
<p>可通过 <span class="math display">\[\left\lceil \frac{x}{y} \right\rceil = \left\lfloor \frac{x + y - 1}{y} \right\rfloor\]</span> 实现 (由于整数除法默认向下取整):</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ceil_div<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>x <span class="op">+</span> y <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">/</span> y<span class="op">;</span> <span class="co">// Automatically does floor division</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="链式调用" class="level3">
<h3 class="anchored" data-anchor-id="链式调用">链式调用</h3>
<p>返回 <code>*this</code> 的引用可以实现链式调用:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chaining.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-chaining" data-filename="chaining.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-chaining-1"><a href="#lst-chaining-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="lst-chaining-2"><a href="#lst-chaining-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-chaining-3"><a href="#lst-chaining-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Point <span class="op">{</span></span>
<span id="lst-chaining-4"><a href="#lst-chaining-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="lst-chaining-5"><a href="#lst-chaining-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="va">x_</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="dt">int</span> <span class="va">y_</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-chaining-6"><a href="#lst-chaining-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-chaining-7"><a href="#lst-chaining-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-chaining-8"><a href="#lst-chaining-8" aria-hidden="true" tabindex="-1"></a>    Point<span class="op">&amp;</span> setX<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-chaining-9"><a href="#lst-chaining-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">x_</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="lst-chaining-10"><a href="#lst-chaining-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span> </span>
<span id="lst-chaining-11"><a href="#lst-chaining-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-chaining-12"><a href="#lst-chaining-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-chaining-13"><a href="#lst-chaining-13" aria-hidden="true" tabindex="-1"></a>    Point<span class="op">&amp;</span> setY<span class="op">(</span><span class="dt">int</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-chaining-14"><a href="#lst-chaining-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">y_</span> <span class="op">=</span> y<span class="op">;</span></span>
<span id="lst-chaining-15"><a href="#lst-chaining-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="lst-chaining-16"><a href="#lst-chaining-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-chaining-17"><a href="#lst-chaining-17" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-chaining-18"><a href="#lst-chaining-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-chaining-19"><a href="#lst-chaining-19" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-chaining-20"><a href="#lst-chaining-20" aria-hidden="true" tabindex="-1"></a>    Point p<span class="op">;</span></span>
<span id="lst-chaining-21"><a href="#lst-chaining-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set values by chaining</span></span>
<span id="lst-chaining-22"><a href="#lst-chaining-22" aria-hidden="true" tabindex="-1"></a>    p<span class="op">.</span>setX<span class="op">(</span><span class="dv">10</span><span class="op">).</span>setY<span class="op">(</span><span class="dv">20</span><span class="op">);</span></span>
<span id="lst-chaining-23"><a href="#lst-chaining-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-chaining-24"><a href="#lst-chaining-24" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="coding-habits" class="level2">
<h2 class="anchored" data-anchor-id="coding-habits">Coding Habits</h2>
<section id="代码风格" class="level3">
<h3 class="anchored" data-anchor-id="代码风格">代码风格</h3>
<ul>
<li>能引用尽量引用不要用指针!</li>
<li>函数的参数尽量少.</li>
</ul>
</section>
<section id="getters-和-setters" class="level3">
<h3 class="anchored" data-anchor-id="getters-和-setters">getters 和 Setters</h3>
<p>为了让外部代码访问和修改类的成员变量, 一种办法是将成员变量声明为 <code>public</code>, 但一旦外部代码写入了不合法的值, 就会导致类的状态变得不可预测. 因此我们用 <code>private</code> + getter/setter 的方式来控制对成员变量的访问和修改.</p>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>account_public.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-account_public" data-filename="account_public.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-account_public-1"><a href="#lst-account_public-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Account <span class="op">{</span></span>
<span id="lst-account_public-2"><a href="#lst-account_public-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-account_public-3"><a href="#lst-account_public-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> balance<span class="op">;</span></span>
<span id="lst-account_public-4"><a href="#lst-account_public-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-account_public-5"><a href="#lst-account_public-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-account_public-6"><a href="#lst-account_public-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="lst-account_public-7"><a href="#lst-account_public-7" aria-hidden="true" tabindex="-1"></a>    Account acc<span class="op">;</span></span>
<span id="lst-account_public-8"><a href="#lst-account_public-8" aria-hidden="true" tabindex="-1"></a>    acc<span class="op">.</span>balance <span class="op">=</span> <span class="op">-</span><span class="dv">999999</span><span class="op">;</span> <span class="co">// Not recommended</span></span>
<span id="lst-account_public-9"><a href="#lst-account_public-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-account_public-10"><a href="#lst-account_public-10" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>account_private.cpp</strong></pre>
</div>
<div class="sourceCode" id="lst-account_private" data-filename="account_private.cpp"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="lst-account_private-1"><a href="#lst-account_private-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Account <span class="op">{</span></span>
<span id="lst-account_private-2"><a href="#lst-account_private-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="lst-account_private-3"><a href="#lst-account_private-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> balance<span class="op">;</span></span>
<span id="lst-account_private-4"><a href="#lst-account_private-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-account_private-5"><a href="#lst-account_private-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="lst-account_private-6"><a href="#lst-account_private-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// const: no modification to member variables</span></span>
<span id="lst-account_private-7"><a href="#lst-account_private-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> getBalance<span class="op">()</span> <span class="at">const</span> <span class="op">{</span> <span class="cf">return</span> balance<span class="op">;</span> <span class="op">}</span></span>
<span id="lst-account_private-8"><a href="#lst-account_private-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-account_private-9"><a href="#lst-account_private-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> deposit<span class="op">(</span><span class="dt">double</span> amount<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-account_private-10"><a href="#lst-account_private-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>amount <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="lst-account_private-11"><a href="#lst-account_private-11" aria-hidden="true" tabindex="-1"></a>            balance <span class="op">+=</span> amount<span class="op">;</span></span>
<span id="lst-account_private-12"><a href="#lst-account_private-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-account_private-13"><a href="#lst-account_private-13" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="lst-account_private-14"><a href="#lst-account_private-14" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="常写-const" class="level3">
<h3 class="anchored" data-anchor-id="常写-const">常写 <code>const</code></h3>
<ul>
<li><p>能加上 <code>const</code> 尽量加上 (比如 <a href="#lst-account_private" class="quarto-xref">Listing&nbsp;<span class="quarto-unresolved-ref">lst-account_private</span></a>).</p></li>
<li><p><code>const</code> 用法:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> <span class="op">*</span>p1<span class="op">;</span> <span class="co">// p1 本身可以修改, 但指向的内容不可以修改</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span> <span class="at">const</span> p2<span class="op">;</span> <span class="co">// p2 本身不可以修改, 但指向的内容可以修改</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> <span class="op">*</span> <span class="at">const</span> p3<span class="op">;</span> <span class="co">// 都不能修改</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="at">const</span><span class="op">&amp;</span> my_int<span class="op">;</span> <span class="co">// 引用的内容不可以修改, 同 const int&amp;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">// int &amp;const // 不合法</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><code>Pytorch C++ API</code> 中提供 <code>TORCH_ARG</code> 宏, 用于自动生成类成员变量的 getter 和 setter 方法:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;torch/torch.h&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>TORCH_ARG<span class="op">(</span><span class="dt">double</span><span class="op">,</span> balance<span class="op">)</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>自动展开为:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> <span class="va">balance_</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// getter</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">double</span><span class="op">&amp;</span> balance<span class="op">()</span> <span class="at">const</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">balance_</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// setter</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span><span class="op">&amp;</span> balance<span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">balance_</span><span class="op">;</span> <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>这种写法类似 <a href="#lst-account_private" class="quarto-xref">Listing&nbsp;<span class="quarto-unresolved-ref">lst-account_private</span></a>, <code>const double&amp;</code> 意思是返回一个不可修改的引用 (若用值拷贝的话速度较慢). 第二个 <code>const</code> 表示 getter 方法本身不会修改这个类的<strong>所有</strong>成员变量 (<code>balance_</code> in this case). 用户可以通过 <code>obj.balance()</code> 来获取余额, 也可以通过 <code>obj.balance() = 100.0;</code> 来修改余额.</p></li>
</ul>
</section>
</section>
<section id="tips-on-code-reading" class="level2">
<h2 class="anchored" data-anchor-id="tips-on-code-reading">Tips on Code Reading</h2>
<section id="first-encounter" class="level3">
<h3 class="anchored" data-anchor-id="first-encounter">First Encounter</h3>
<ul>
<li><p><strong>Take it Easy</strong>: 一个 <code>C++</code> project 不过是一堆 class 和一个 main.</p></li>
<li><p>如果是 OOP, 关注类会<strong>改变</strong>哪些外部变量 (通常是引用传递) 而不是某个方法的具体实现.</p></li>
</ul>
</section>
</section>
<section id="verilog" class="level2">
<h2 class="anchored" data-anchor-id="verilog">Verilog</h2>
<blockquote class="blockquote">
<p><strong><em>Change of Mind:</em></strong> Hardware does not “execute” the lines of code in sequence.</p>
</blockquote>
<ul>
<li><p><code>assign</code></p>
<ul>
<li>多个 <code>assign</code> 执行<strong>没有顺序</strong>, 同时进行.</li>
<li><code>assign</code> 是 “continuous assignment”, 右值变化时, 左值跟着变化.</li>
</ul></li>
<li><p><strong>Operation 运算符</strong>: <code>~</code>, <code>!</code> (logical), <code>&amp;</code>, <code>&amp;&amp;</code> (logical), <code>|</code>, <code>||</code> (logical), <code>^</code> (XOR).</p></li>
<li><p><code>if, else if</code> 是有顺序的!!!</p></li>
<li><p>(procedure 一定要放在 always 块中吗?)</p></li>
<li><p>(为什么 wire 类型不能在 always 里面被赋值?)</p></li>
<li><p><code>always</code> 块中的代码是<strong>顺序执行</strong>的 (但在 <code>always</code> 块外的代码是<strong>并行执行</strong>的).</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode verilog code-with-copy"><code class="sourceCode verilog"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> top <span class="op">(</span><span class="dt">input</span> my_in<span class="op">,</span> <span class="dt">output</span> <span class="dt">reg</span> my_out<span class="op">);</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">always</span> <span class="op">@(</span>*<span class="op">)</span> <span class="kw">begin</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>        my_out <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>        my_out <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> <span class="co">// This is valid! (Always block 按顺序执行)</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="kw">endmodule</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p><strong>Latch 推断</strong>: 下面如果 <code>cpu_overheated = 0</code> 则默认会让 <code>shut_off_computer</code> 保持上一个值, 这就是 latch 推断.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode verilog code-with-copy"><code class="sourceCode verilog"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">always</span> <span class="op">@(</span>*<span class="op">)</span> <span class="kw">begin</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>cpu_overheated<span class="op">)</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>        shut_off_computer <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>有时我们就是需要这种推断, 但为了避免, 可以利用always 的顺序性先提前赋值:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode verilog code-with-copy"><code class="sourceCode verilog"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">always</span> <span class="op">@(</span>*<span class="op">)</span> <span class="kw">begin</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    shut_off_computer <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// 先提前赋值</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>cpu_overheated<span class="op">)</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>        shut_off_computer <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><p><strong>Concatenation</strong>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode verilog code-with-copy"><code class="sourceCode verilog"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">assign</span> out <span class="op">=</span> <span class="op">{</span>tmp<span class="op">,</span> <span class="op">{</span><span class="dv">3</span><span class="op">{</span><span class="bn">3'b100</span><span class="op">}}};</span> <span class="co">// Concatenation, out = 0000011 100 100 100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>index 可以是负数:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode verilog code-with-copy"><code class="sourceCode verilog"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="dt">reg</span> <span class="op">[</span><span class="dv">5</span><span class="op">:-</span><span class="dv">1</span><span class="op">]</span> my_reg<span class="op">;</span> <span class="co">// index 可以是负数.</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="dt">wire</span> <span class="op">[</span><span class="dv">0</span><span class="op">:</span><span class="dv">3</span><span class="op">]</span> my_wire<span class="op">;</span> <span class="co">// Big-endian, mywire[0] is MSB, use my_wire[3:0] later is illegal!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><code>input a</code> 默认为 <code>wire</code>.</p></li>
<li><p><code>begin end</code> 在只有一行代码时可以省略 (相当于 C 中的 <code>{}</code>).</p></li>
<li><p><code>wire</code> 不能在 <code>always</code> 块中被赋值. <code>reg</code> 才能在 <code>always</code> 中被赋值.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode verilog code-with-copy"><code class="sourceCode verilog"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="dt">wire</span> a<span class="op">;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">always</span> <span class="op">@(</span>*<span class="op">)</span> <span class="kw">begin</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">assign</span> a <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> <span class="co">// Error!</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode verilog code-with-copy"><code class="sourceCode verilog"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="dt">wire</span> a<span class="op">;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">always</span> <span class="op">@(</span>*<span class="op">)</span> <span class="kw">begin</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">&lt;=</span> <span class="dv">1</span><span class="op">;</span> <span class="co">// Not an error, `a` is viewed as a reg.</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Synchronous and Asynchronous Reset</strong>:</p>
<ul>
<li><p>synchronous reset:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode verilog code-with-copy"><code class="sourceCode verilog"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">always</span> <span class="op">@(</span><span class="kw">posedge</span> clk<span class="op">)</span> <span class="kw">begin</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>reset<span class="op">)</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>asynchronous reset:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode verilog code-with-copy"><code class="sourceCode verilog"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">always</span> <span class="op">@(</span><span class="kw">posedge</span> clk <span class="dt">or</span> <span class="kw">posedge</span> reset<span class="op">)</span> <span class="kw">begin</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>reset<span class="op">)</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><p><code>or</code> <strong>只能</strong>在 <code>always</code> 块中使用, <code>if ()</code> 中要用 <code>||</code>.</p></li>
<li><p><strong>Inference</strong> 和 <strong>Instantiation</strong>:</p>
<ul>
<li><strong>Inference</strong>: 通过 <code>always</code> 块的内容推断出一个模块的功能.</li>
<li><strong>Instantiation</strong>: 显式地实例化一个模块, 通过 <code>module_name instance_name (port_map)</code> 的方式.</li>
</ul></li>
<li><p>循环群结构 (Torus, etc) 如果用 <code>%</code> 运算符来处理会消耗大量资源, <strong>尽量用 <code>if</code> 语句</strong>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode verilog code-with-copy"><code class="sourceCode verilog"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>mm <span class="op">==</span> <span class="bn">8'd59</span><span class="op">)</span> <span class="kw">begin</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    mm <span class="op">&lt;=</span> <span class="bn">8'd0</span><span class="op">;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>如果用 <code>%</code> 运算符来处理:
<ul>
<li><code>-1 % 16</code> 的结果是 <code>-1</code>, 而不是 <code>15</code> (所以 <code>(a-1)%16</code> 应该写成 <code>(a+15)%16</code>).</li>
<li>1~12 的循环先转换为 0~11 的循环, 再换元.</li>
</ul></li>
</ul></li>
<li><p><strong>BCD (Binary-Coded Decimal)</strong>: 一种从 0 到 9 的计数器, 输出是四位二进制编码的十进制数.</p></li>
<li><p><strong>Blocking 和 Non-blocking assignments</strong>:</p>
<ul>
<li><code>=</code>: Blocking assignment, 若在 <code>always</code> 块中使用, 则必须按照顺序执行!</li>
<li><code>&lt;=</code>: Non-blocking assignment, 在 <code>always</code> 块中使用时, 会同时执行所有赋值. (一般 <code>always</code> 里面都用这个!)</li>
</ul></li>
</ul>
<section id="verilog-testbench" class="level3">
<h3 class="anchored" data-anchor-id="verilog-testbench">Verilog Testbench</h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode verilog code-with-copy"><code class="sourceCode verilog"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ot">`timescale 1ns / 1ps </span><span class="co">// #1 代表 1ns, 最精确可以到 #1.001</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="ot">`timescale 1ns / 1ns </span><span class="co">// #1 代表 1ns, #1.01 等是不合法的</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="dt">$stop</span> <span class="co">//停下来</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="chisel" class="level2">
<h2 class="anchored" data-anchor-id="chisel">Chisel</h2>
<ul>
<li><p><code>+&amp;</code>: 如果 <code>io.in_a</code> 和 <code>io.in_b</code> 为 <code>4.W</code> 时, 则 <code>sum</code> 为 <code>5.W</code> (带溢出).</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> sum <span class="op">=</span> io<span class="op">.</span>in_a <span class="op">+&amp;</span> io<span class="op">.</span>in_b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>允许多个 <code>:=</code> 赋值到同一个输出:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>io<span class="op">.</span>out <span class="op">:=</span> <span class="fl">0.</span>U</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>io<span class="op">.</span>out <span class="op">:=</span> <span class="fl">1.</span>U <span class="co">// 覆盖上一个</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><code>if</code> 和 <code>when</code> 的区别:</p>
<ul>
<li><code>if</code> 用来在编译阶段决定电路是哪一种</li>
<li><code>when</code> 用来生成固定的 verilog 电路, 相当于 verilog 的 <code>if</code>.</li>
</ul></li>
<li><p><code>orR</code>: reduction OR, 对所有位进行 OR 操作. 比如 GPR 读寄存器时, 只要地址不是全 0，就读出寄存器的值 (即创建了一个虚拟的 x0 寄存器，值恒为 0):</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>io<span class="op">.</span>rdata1 <span class="op">:=</span> <span class="fu">Mux</span><span class="op">(</span>io<span class="op">.</span>raddr1<span class="op">.</span>orR<span class="op">,</span> <span class="fu">regs</span><span class="op">(</span>io<span class="op">.</span>raddr1<span class="op">),</span> <span class="fl">0.</span>U<span class="op">)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>io<span class="op">.</span>rdata2 <span class="op">:=</span> <span class="fu">Mux</span><span class="op">(</span>io<span class="op">.</span>raddr2<span class="op">.</span>orR<span class="op">,</span> <span class="fu">regs</span><span class="op">(</span>io<span class="op">.</span>raddr2<span class="op">),</span> <span class="fl">0.</span>U<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<section id="area-optimization-面积优化方法" class="level3">
<h3 class="anchored" data-anchor-id="area-optimization-面积优化方法">Area Optimization 面积优化方法</h3>
<blockquote class="blockquote">
<p>有时可读性强的代码会导致使用的逻辑门更多, 占用更多面积. 所以一个模块有时会写两种版本, 一种是可读性强的, 另一种是面积优化的版本.</p>
</blockquote>
<section id="cse-公共子表达式消除" class="level4">
<h4 class="anchored" data-anchor-id="cse-公共子表达式消除">CSE 公共子表达式消除</h4>
<p><strong>Common Subexpression Elimination</strong> 也是编译器优化的一种. 举个简单的例子:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> y <span class="op">=</span> a <span class="op">+</span> b<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>可以优化为:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> temp <span class="op">=</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> temp<span class="op">;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> y <span class="op">=</span> temp<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>这样就避免了重复计算 <code>a + b</code> 两次.</p>
<p>在 RTL 设计中, 比如 <a href="#lst-AddSubSimple" class="quarto-xref">Listing&nbsp;<span class="quarto-unresolved-ref">lst-AddSubSimple</span></a> 这个简单的加减法模块, <strong>注意到 “减法” 其实等价于 “加上 B 的补码”</strong>, 可以得到更优化的版本 <a href="#lst-AddSubArea" class="quarto-xref">Listing&nbsp;<span class="quarto-unresolved-ref">lst-AddSubArea</span></a>:</p>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>AddSubSimple.scala</strong></pre>
</div>
<div class="sourceCode" id="lst-AddSubSimple" data-filename="AddSubSimple.scala"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="lst-AddSubSimple-1"><a href="#lst-AddSubSimple-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AddSubSimple <span class="kw">extends</span> Module <span class="op">{</span></span>
<span id="lst-AddSubSimple-2"><a href="#lst-AddSubSimple-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> io <span class="op">=</span> <span class="fu">IO</span><span class="op">(</span><span class="kw">new</span> Bundle <span class="op">{</span></span>
<span id="lst-AddSubSimple-3"><a href="#lst-AddSubSimple-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> a <span class="op">=</span> <span class="fu">Input</span><span class="op">(</span><span class="fu">UInt</span><span class="op">(</span><span class="fl">8.</span>W<span class="op">))</span></span>
<span id="lst-AddSubSimple-4"><a href="#lst-AddSubSimple-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> b <span class="op">=</span> <span class="fu">Input</span><span class="op">(</span><span class="fu">UInt</span><span class="op">(</span><span class="fl">8.</span>W<span class="op">))</span></span>
<span id="lst-AddSubSimple-5"><a href="#lst-AddSubSimple-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> sub <span class="op">=</span> <span class="fu">Input</span><span class="op">(</span><span class="fu">Bool</span><span class="op">())</span>   <span class="co">// true 表示减法</span></span>
<span id="lst-AddSubSimple-6"><a href="#lst-AddSubSimple-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> out <span class="op">=</span> <span class="fu">Output</span><span class="op">(</span><span class="fu">UInt</span><span class="op">(</span><span class="fl">8.</span>W<span class="op">))</span></span>
<span id="lst-AddSubSimple-7"><a href="#lst-AddSubSimple-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">})</span></span>
<span id="lst-AddSubSimple-8"><a href="#lst-AddSubSimple-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-AddSubSimple-9"><a href="#lst-AddSubSimple-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 两个独立运算单元</span></span>
<span id="lst-AddSubSimple-10"><a href="#lst-AddSubSimple-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> addRes <span class="op">=</span> io<span class="op">.</span>a <span class="op">+</span> io<span class="op">.</span>b</span>
<span id="lst-AddSubSimple-11"><a href="#lst-AddSubSimple-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> subRes <span class="op">=</span> io<span class="op">.</span>a <span class="op">-</span> io<span class="op">.</span>b</span>
<span id="lst-AddSubSimple-12"><a href="#lst-AddSubSimple-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-AddSubSimple-13"><a href="#lst-AddSubSimple-13" aria-hidden="true" tabindex="-1"></a>  io<span class="op">.</span>out <span class="op">:=</span> <span class="fu">Mux</span><span class="op">(</span>io<span class="op">.</span>sub<span class="op">,</span> subRes<span class="op">,</span> addRes<span class="op">)</span></span>
<span id="lst-AddSubSimple-14"><a href="#lst-AddSubSimple-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-AddSubSimple-15"><a href="#lst-AddSubSimple-15" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>AddSubArea.scala</strong></pre>
</div>
<div class="sourceCode" id="lst-AddSubArea" data-filename="AddSubArea.scala"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="lst-AddSubArea-1"><a href="#lst-AddSubArea-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AddSubOptimized <span class="kw">extends</span> Module <span class="op">{</span></span>
<span id="lst-AddSubArea-2"><a href="#lst-AddSubArea-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> io <span class="op">=</span> <span class="fu">IO</span><span class="op">(</span><span class="kw">new</span> Bundle <span class="op">{</span></span>
<span id="lst-AddSubArea-3"><a href="#lst-AddSubArea-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> a <span class="op">=</span> <span class="fu">Input</span><span class="op">(</span><span class="fu">UInt</span><span class="op">(</span><span class="fl">8.</span>W<span class="op">))</span></span>
<span id="lst-AddSubArea-4"><a href="#lst-AddSubArea-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> b <span class="op">=</span> <span class="fu">Input</span><span class="op">(</span><span class="fu">UInt</span><span class="op">(</span><span class="fl">8.</span>W<span class="op">))</span></span>
<span id="lst-AddSubArea-5"><a href="#lst-AddSubArea-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> sub <span class="op">=</span> <span class="fu">Input</span><span class="op">(</span><span class="fu">Bool</span><span class="op">())</span></span>
<span id="lst-AddSubArea-6"><a href="#lst-AddSubArea-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> out <span class="op">=</span> <span class="fu">Output</span><span class="op">(</span><span class="fu">UInt</span><span class="op">(</span><span class="fl">8.</span>W<span class="op">))</span></span>
<span id="lst-AddSubArea-7"><a href="#lst-AddSubArea-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">})</span></span>
<span id="lst-AddSubArea-8"><a href="#lst-AddSubArea-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-AddSubArea-9"><a href="#lst-AddSubArea-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 如果是减法，就取 -B；否则取 B</span></span>
<span id="lst-AddSubArea-10"><a href="#lst-AddSubArea-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> b_eff <span class="op">=</span> <span class="fu">Mux</span><span class="op">(</span>io<span class="op">.</span>sub<span class="op">,</span> <span class="op">-</span>io<span class="op">.</span>b<span class="op">,</span> io<span class="op">.</span>b<span class="op">)</span></span>
<span id="lst-AddSubArea-11"><a href="#lst-AddSubArea-11" aria-hidden="true" tabindex="-1"></a>  io<span class="op">.</span>out <span class="op">:=</span> io<span class="op">.</span>a <span class="op">+</span> b_eff</span>
<span id="lst-AddSubArea-12"><a href="#lst-AddSubArea-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-AddSubArea-13"><a href="#lst-AddSubArea-13" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>对比他们两个 <code>sbt</code> 出来的 <code>verilog</code> 代码:</p>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>AddSubSimple.v</strong></pre>
</div>
<div class="sourceCode" id="cb42" data-filename="AddSubSimple.v"><pre class="sourceCode verilog code-with-copy"><code class="sourceCode verilog"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> AddSubSimple<span class="op">(</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input</span>        clock<span class="op">,</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input</span>        reset<span class="op">,</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input</span>  <span class="op">[</span><span class="dv">7</span><span class="op">:</span><span class="dv">0</span><span class="op">]</span> io_a<span class="op">,</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input</span>  <span class="op">[</span><span class="dv">7</span><span class="op">:</span><span class="dv">0</span><span class="op">]</span> io_b<span class="op">,</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input</span>        io_sub<span class="op">,</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">output</span> <span class="op">[</span><span class="dv">7</span><span class="op">:</span><span class="dv">0</span><span class="op">]</span> io_out</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">wire</span> <span class="op">[</span><span class="dv">7</span><span class="op">:</span><span class="dv">0</span><span class="op">]</span> addRes <span class="op">=</span> io_a <span class="op">+</span> io_b<span class="op">;</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">wire</span> <span class="op">[</span><span class="dv">7</span><span class="op">:</span><span class="dv">0</span><span class="op">]</span> subRes <span class="op">=</span> io_a <span class="op">-</span> io_b<span class="op">;</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">assign</span> io_out <span class="op">=</span> io_sub <span class="op">?</span> subRes <span class="op">:</span> addRes<span class="op">;</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="kw">endmodule</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>AddSubArea.v</strong></pre>
</div>
<div class="sourceCode" id="cb43" data-filename="AddSubArea.v"><pre class="sourceCode verilog code-with-copy"><code class="sourceCode verilog"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> AddSubArea<span class="op">(</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input</span>        clock<span class="op">,</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input</span>        reset<span class="op">,</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input</span>  <span class="op">[</span><span class="dv">7</span><span class="op">:</span><span class="dv">0</span><span class="op">]</span> io_a<span class="op">,</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input</span>  <span class="op">[</span><span class="dv">7</span><span class="op">:</span><span class="dv">0</span><span class="op">]</span> io_b<span class="op">,</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input</span>        io_sub<span class="op">,</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">output</span> <span class="op">[</span><span class="dv">7</span><span class="op">:</span><span class="dv">0</span><span class="op">]</span> io_out</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">wire</span> <span class="op">[</span><span class="dv">7</span><span class="op">:</span><span class="dv">0</span><span class="op">]</span> _b_eff_T_1 <span class="op">=</span> <span class="bn">8'h0</span> <span class="op">-</span> io_b<span class="op">;</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">wire</span> <span class="op">[</span><span class="dv">7</span><span class="op">:</span><span class="dv">0</span><span class="op">]</span> b_eff <span class="op">=</span> io_sub <span class="op">?</span> _b_eff_T_1 <span class="op">:</span> io_b<span class="op">;</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">assign</span> io_out <span class="op">=</span> io_a <span class="op">+</span> b_eff<span class="op">;</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="kw">endmodule</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>


</section>
</section>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../cc-os/cc-os.html" class="pagination-link" aria-label="OS 操作系统原理">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">OS 操作系统原理</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../cc-fpga/cc-fpga.html" class="pagination-link" aria-label="FPGA 原理速成">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">FPGA 原理速成</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>