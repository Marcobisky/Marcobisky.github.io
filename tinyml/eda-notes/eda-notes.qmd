---
title: "EDA Notes 笔记"
---

## Takeaways

- 处处都是优化问题, 一般的思路就是先 brainstorm 你能想到的**要减小**的「因素」 (要增大的话填负号即可), 然后一股脑**全加起来**作为 Loss function. 然后:
    - @liao_2023_dreamplace 给我们的启发就是将这个问题等价变成一个训练神经网络的问题, 利用 `torch` 的生态来并行计算.
    - 如果 Loss function 里有不可微的部分. 两种办法: 
        - 直接分段函数哈哈哈 (反正 `torch` 里面也是用查找表算的梯度, 它也不知道它优化的函数可不可微哈哈, 这个办法在 @liao2023analyticaldietodie3dplacement 叫做 **subgradient**).
        - 用某种平滑的方法来强行可微, 方法很多, 你也可以自己设计.

- Net weight @liao_2023_dreamplace 的 idea 告诉我们有些难以单读开一个表达式的「因素」可以融入其它的「因素」里!

## Some Terms {#sec-eda-terms}

- **Hypergraph 超图**: 图的一种推广, Netlist 常被建模成 (Directed @liao_2023_dreamplace) hypergraph $(V, E)$ (edge 可以有多个 vertex).
    - $V$ 中的元素代表 **pin**.
    - $E$ 中的元素称为一个 **net**.

- **Layout**: 元件或电路的 electric function 的几何图形表示 @phdthesisAlgorithms2019.

- **Standard Cell (std cell) 标准单元**: 一组实现逻辑门的物理单元 (AND, OR, NOT, NAND, etc.) @phdthesisAlgorithms2019. 他们过于基础以至于被称为 "standard".

    ![NOT 和 NAND 的 layout @phdthesisAlgorithms2019](layout.png){#fig-layout width=80%}

:::{.column-margin}
![Std cell height 不一定等于 row height @phdthesisAlgorithms2019.](mutideck-std-cell.png){#fig-mutideck-std-cell}
:::

## Placement 布局

### 三个阶段

- **Global (coarse/initial) placement**: 把 cell/macro 粗略地放置在芯片上的过程 (不必对齐 row/site, 单元之间允许重叠, 但其实会尽量避免重叠) @phdthesisAlgorithms2019. 

    ![Legalization 把 cell/macro 吸附到最近的 row/site 上并推开重叠 @phdthesisAlgorithms2019](legalization.png){#fig-legalization width=70%}

- **Legalization 合法化**: 消除重叠和在**两个**方向对齐的过程 (见 @fig-legalization). Cell/macro 不能随便放置, 而要在两个方向对齐:
    - **Row**: 见 @fig-layout, 每个 std cell 的上下为该 cell 的供电 metal (上 VDD 下 GND), 我们希望每个 std cell 的这两个 metal 共线, 这样才方便提供同意的供电. 自然的, 所有 cell/macro 不能随便放置, 而要在水平方向成一条线, 使得 die 有“一层一层”的概念, **每一层称为一个 row**. Row height 等于 std cell height; Row 分隔线 VDD 和 GND 交替.
    - **Site**: Row 引入了「层」, 而 site 给每一层也数字化引入了「门牌号」, 每个 cell/macro 必须对齐到 row 和 site 边界!

:::{layout = "[40,60]"}
![Cell/macro 必须放在 row 上 @phdthesisAlgorithms2019.](rowdemo.png){#fig-rowdemo}

![Std cell 必须上下对齐 row, 左右对齐 site @phdthesisAlgorithms2019.](sitedemo.png){#fig-sitedemo}
:::

- **Detailed placement**

### Wirelength Model

![两种估计后续布线时线长的模型: 1. HPWL; 2. 通过构建 RSMT 来计算 @_2024_a7vlsi.](wirelength-model.png){#fig-wirelength-model width=80%}

### Density Model

- **Bin**: 仅仅是为了**方便计算**[^bin]布局的密度 @_2024_83 (即有限元方法), 整个 die 被划分为若干个小的矩形区域 (厚度跟 die 的厚度一样), 每个小区域称为一个 bin @zhao2024analyticalheterogeneousdietodie3d (见 @fig-bindemo). 所有的 bin 组成的集合记作 $B$.

    ![此图中 bin 的高度是 row height 的 $4$ 倍 @phdthesisAlgorithms2019](bindemo.png){#fig-bindemo width=70%}

[^bin]: 注意区分 bin 和 row/site 围成的小方格! 前者是为了计算密度而人为划分的区域, 后者是为了放置 cell/macro 而划分的区域.

### Timing Model

- 单独引入衡量 Timing 的 explicit form 是困难的 (为什么?). 于是 @liao_2023_dreamplace 天才般地通过**引入 net weight 将 timing 的信息融合进 wirelength model 里** 从而使得优化过程考虑了 timing 因素!!

TODO

## References
